let J=b;function a(){let e=["y29UDgv4","zMLSDgvY","CIbPBIa","jYbPCYbH","DMvYC2LV","DMfSDwu","zufKzg9U","Dgv4Da","C3vJy2vZ","CMvZB2X2","C2v0","z2v0qwXS","DMfSDwvZ","zxzLBNri","nhWZ","BNriyw5K","A2r4yLe","yw1L","B3v0igfM","tgLZDgvU","w0fere9o","ChjPB3jP","Cgf0Aa","CIb0Aw1L","C2L6zq","DMvxBue","C3rLCKfK","neXOsw1xuq","ywrKB246","CgvYBwLZ","ALnUrMG","BgvUz3rO","sgfUzgXL","qwrKB24G","mJaXmZGYofPdDvHwEG","z2v0u3rH","CMvNAxn0","zg9UrxzL","z2v0","DMvUDca","y2XPzw50","DgXLza","zxzLBNrZ","ywXSu2v0","y29UzMLN","nJm4odq5mgT3sMXzta","zw5HyMXL","Dw5YzwDP","zxjYB3i","zM9YrwfJ","yw5KBgvY","ohzNDxj0tq","ywrKB25o","nJCYnJG4muzVBfncDq","ChrPB24","oxj4DuPkwq","zgvSzxrL","ode4mtyYtuLAzw5X","zxjfDMvU","mJaYmdG2mtDhD3jRwfO","mJu0ntu5nwvNz2P2rG","zNvSzMLS","CMvHC29U","CwnquMq","zw1PDcbL","zNjVBq","CMvKDwnL","DeHHBMrS","mtm2mdq0m3zorhPdDa","C3bSAxq","ywrKB25Z","zw1PDfnH","qwrKB25Z","BgvK","ChvZAa","mtjmwxn5r3a","zw1PDefK","xsbfCNjV","ms4WlJa","A0DAtM8","z3vPBgq","A2v5CW"];return(a=function(){return e})()}function b(s,e){let o=a();return(b=function(e,t){e-=278;let r=o[e];void 0===b.OhrUAn&&(b.nFqwwF=function(s){let a="",r="";for(let e=0,t,r,n=0;r=s.charAt(n++);~r&&(t=e%4?64*t+r:r,e++%4)&&(a+=String.fromCharCode(255&t>>(-2*e&6))))r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(r);for(let e=0,t=a.length;e<t;e++)r+="%"+("00"+a.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(r)},s=arguments,b.OhrUAn=!0);var e=e+o[0],n=s[e];return n?r=n:(r=b.nFqwwF(r),s[e]=r),r})(s,e)}(()=>{for(var e=b,t=a();;)try{if(883323==-parseInt(e(289))+-parseInt(e(278))/2*(-parseInt(e(296))/3)+parseInt(e(330))/4*(parseInt(e(281))/5)+parseInt(e(337))/6+parseInt(e(356))/7*(parseInt(e(354))/8)+-parseInt(e(358))/9*(-parseInt(e(348))/10)+-parseInt(e(280))/11)break;t.push(t.shift())}catch(e){t.push(t.shift())}})();let EventEmitter=require(J(345)),path=require(J(325));class AddonEventManager extends EventEmitter{constructor(){var e=J,t=("0|1|2|"+e(317))[e(290)]("|");let r=0;for(;;){switch(t[r++]){case"0":super();continue;case"1":this["setMax"+e(322)+"ers"](100);continue;case"2":this.addons=new Map;continue;case"3":this.context={client:null,config:null,lang:null};continue;case"4":this[e(316)+e(353)+"s"]=new Map;continue}break}}["setCon"+J(310)](e,t,r){var n=J;this[n(303)+"t"][n(343)]=e,this[n(303)+"t"][n(347)]=t,this[n(303)+"t"].lang=r}["registerAddon"](r,e){const n=J,t=n(284),s="QjMvK";if(this[n(291)].has(r)){if(t===s)return e.from(this.eventHandlers.keys());throw new Error(n(336)+"'"+r+n(306)+"lready registered")}let a={name:r,version:e[n(307)+"n"]||n(299),description:e["descri"+n(357)]||"",events:e.events||{},permissions:e[n(332)+"sions"]||[],priority:e.priority||0,enabled:!0};return this.addons.set(r,a),Object.keys(a[n(345)])[n(352)+"h"](e=>{var t=n;this[t(339)+"erEventHandler"](r,e,a.events[e],a[t(324)+"ty"])}),this[n(292)+"fe"](n(331)+n(339)+"ered",{name:r,addon:a,timestamp:new Date}),a}["regist"+J(279)+J(288)+"er"](e,t,r,n=0){let s=J;this["eventH"+s(353)+"s"].has(t)||this["eventH"+s(353)+"s"].set(t,[]);e={addonName:e,handler:r,priority:n,enabled:!0},r=this["eventH"+s(353)+"s"][s(341)](t);r.push(e),r.sort((e,t)=>t.priority-e[s(324)+"ty"]),this[s(316)+s(353)+"s"][s(313)](t,r)}[J(350)+J(329)+"don"](s){let a=J,e={kEbWy:a(333),IdHkO:"addon:"+a(350)+"stered"};if(!this.addons.has(s)){if(a(333)===e.kEbWy)return!1;this.eventHandlers.set(e,[])}var t=this[a(291)][a(341)](s);return this[a(316)+a(353)+"s"].forEach((e,t)=>{let r=a,n=e[r(304)](e=>e[r(355)+r(320)]!==s);0===n[r(334)]?this[r(316)+"andlers"].delete(t):this[r(316)+r(353)+"s"].set(t,n)}),this.addons[a(359)](s),this.emitSafe(e.IdHkO,{name:s,addon:t,timestamp:new Date}),!0}async[J(297)+J(340)+"nt"](a,i,e={}){let d=J,s={veWmA:function(e,t,r){return e(t,r)}},{timeout:l=5e3,allowParallel:t=!0,stopOnError:r=!1}=e,u=this["eventH"+d(353)+"s"][d(341)](a)||[],h=u[d(304)](t=>{let r=d;if("VVDGg"!==r(300)){let e=this.addons[r(341)](t.addonName);return e&&e.enabled&&t[r(349)+"d"]}s[r(328)](t,()=>m(new n(r(335)+r(326)+r(321)+"ter "+o+"ms")),t)});if(0===h.length)return{success:!0,results:[]};let v={...this.context,eventName:a,timestamp:new Date,guild:i[d(301)]||null,user:i.user||null},c=[];if(t){let e=h.map(async t=>{var r=d;try{var e=new Promise((e,t)=>{let r=b;setTimeout(()=>t(new Error(r(335)+r(326)+r(321)+"ter "+l+"ms")),l)}),n=Promise[r(312)+"e"](t.handler(i,v)),s=await Promise.race([n,e]);return{addonName:t.addonName,success:!0,result:s,error:null}}catch(e){return console[r(351)]("[ADDON"+r(298)+r(305)+t.addonName+" handling "+a+":",e),{addonName:t["addonN"+r(320)],success:!1,result:null,error:e.message}}}),t=await Promise[d(346)+d(344)](e);c[d(295)](...t.map(e=>e.status===d(282)+d(294)?e[d(308)]:{success:!1,error:e[d(283)]?.message||"Unknown error"}))}else for(let n of h)try{let e=new Promise((e,t)=>{setTimeout(()=>t(new Error("Handler timeout after "+l+"ms")),l)}),t=Promise.resolve(n.handler(i,v)),r=await Promise.race([t,e]);c.push({addonName:n["addonN"+d(320)],success:!0,result:r,error:null})}catch(e){if(console.error(d(323)+d(298)+"r in "+n.addonName+" handling "+a+":",e),c.push({addonName:n[d(355)+"ame"],success:!1,result:null,error:e.message}),r)break}return{success:!c.some(e=>!e[d(311)+"s"])||!r,results:c,eventName:a,handlerCount:h.length}}[J(292)+"fe"](r,e,n={}){let s=J;({kdxbQ:function(e,t){return e(t)}})[s(319)](setImmediate,async()=>{var t=s;try{await this[t(297)+t(340)+"nt"](r,e,n)}catch(e){console.error(t(323)+"] Failed to "+t(285)+t(342)+r+":",e)}})}["enableAddon"](e){e=this.addons.get(e);return!!e&&(e.enabled=!0)}["disabl"+J(309)](e){var t=J,e=this[t(291)].get(e);return!!e&&!(e[t(349)+"d"]=!1)}["getAddonInfo"](e){var t=J;return this.addons[t(341)](e)||null}[J(314)+J(293)](){var e=J;return Array.from(this[e(291)][e(315)]())}["getEve"+J(318)+"lers"](e){var t=J;return this[t(316)+"andlers"][t(341)](e)||[]}["getAllEvents"](){var e=J;return Array[e(286)](this[e(316)+e(353)+"s"][e(302)]())}[J(338)+"ts"](){let r=J,e=this.addons.size,t=Array.from(this.addons[r(315)]()).filter(e=>e[r(349)+"d"]).length,n=this.eventHandlers[r(327)],s=Array.from(this.eventHandlers[r(315)]())[r(287)]((e,t)=>e+t[r(334)],0);return{totalAddons:e,enabledAddons:t,totalEvents:n,totalHandlers:s}}}module.exports=AddonEventManager;