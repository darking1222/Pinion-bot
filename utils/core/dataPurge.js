let u=b;function b(n,t){let u=a();return(b=function(t,e){t-=137;let r=u[t];void 0===b.EXTWsA&&(b.SAsfJm=function(n){let a="",r="";for(let t=0,e,r,s=0;r=n.charAt(s++);~r&&(e=t%4?64*e+r:r,t++%4)&&(a+=String.fromCharCode(255&e>>(-2*t&6))))r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(r);for(let t=0,e=a.length;t<e;t++)r+="%"+("00"+a.charCodeAt(t).toString(16)).slice(-2);return decodeURIComponent(r)},n=arguments,b.EXTWsA=!0);var t=t+u[0],s=n[t];return s?r=s:(r=b.SAsfJm(r),n[t]=r),r})(n,t)}(()=>{for(var t=b,e=a();;)try{if(331482==-parseInt(t(218))+-parseInt(t(197))/2+parseInt(t(186))/3*(parseInt(t(227))/4)+-parseInt(t(150))/5+parseInt(t(203))/6+-parseInt(t(185))/7+-parseInt(t(184))/8)break;e.push(e.shift())}catch(t){e.push(e.shift())}})();let getConfig=require(u(225)+u(216)+"er").getConfig,UserData=require(u(180)+"models/UserD"+u(220)),Ticket=require(u(180)+"models"+u(165)+"ts"),colors=require(u(173)+u(204));class DataPurgeService{static async["purgeU"+u(188)+u(221)](){var e=u,r={XAziF:function(t){return t()},nPbmq:function(t,e){return t*e},BzoLt:e(193)+e(195)+e(206)};try{var t,s,n=r[e(142)](getConfig);return n["DataPu"+e(179)]?.Enabled&&n[e(205)+e(179)]?.[e(222)+e(148)]?.[e(147)+"d"]?(t=n[e(205)+"rge"]["UserMe"+e(148)][e(146)+"ionDays"],s=Date[e(191)]()-1e3*r[e(174)](24*t*60,60),{success:!0,modifiedCount:(await UserData[e(151)+e(201)]({},{$pull:{messages:{timeSent:{$lt:s}}}}))[e(187)+"edCount"],type:"user_m"+e(182)+"s"}):{success:!1,reason:e(138)+e(182)+"s purg"+e(229)+e(141)+"d"}}catch(t){return console.error(colors[e(169)](r[e(215)])+(" Faile"+e(223)+"urge user me"+e(148))+":",t),{success:!1,error:t.message}}}static async["purgeTransactionLogs"](){var e=u,t={KpYuZ:function(t,e){return t*e},NWdyn:function(t,e){return t*e},adAJs:"$transaction"+e(159),riwoJ:e(170)+e(162)+"tamp",SQQHR:function(t,e){return t+e}};try{var r,s,n,a,i=getConfig();return i.DataPurge?.[e(147)+"d"]&&i.DataPurge?.[e(172)+"ctionL"+e(198)]?.Enabled?(r=i.DataPurge.TransactionLogs[e(146)+e(176)+"s"],s=new Date(Date.now()-60*t[e(163)](t[e(153)](r,24),60)*1e3),n=await UserData[e(151)+"Many"]({},{$pull:{transactionLogs:{timestamp:{$lt:s,$type:e(231)}}}}),a=await UserData[e(151)+e(201)]({"transactionLogs.0":{$exists:!0}},[{$set:{transactionLogs:{$filter:{input:t[e(144)],cond:{$not:{$and:[{$eq:[{$type:t[e(228)]},"string"]},{$lt:[{$dateFromString:{dateString:"$$this"+e(162)+"tamp"}},s]}]}}}}}}]),{success:!0,modifiedCount:t.SQQHR(n["modifi"+e(217)+"t"],a["modifi"+e(217)+"t"]),type:e(224)+"ction_"+e(160)}):{success:!1,reason:"Transaction "+e(219)+"urge is disabled"}}catch(t){return console.error(colors[e(169)](e(193)+e(195)+e(206))+(" Faile"+e(223)+e(145)+e(194))+"tion logs:",t),{success:!1,error:t[e(155)+"e"]}}}static async["purgeT"+u(230)](){var n=u,a={HmpJw:"Transa"+n(139)+"logs purge i"+n(137)+"bled",HYfHQ:"sbtPu",KmACl:function(t,e){return t-e},ykpSM:function(t,e){return t*e},kxKTj:"deleted",cxoPi:n(152),PjobD:"[DATA PURGE ERROR]"};try{var i=getConfig();if(!i["DataPu"+n(179)]?.Enabled||!i["DataPu"+n(179)]?.Tickets?.[n(147)+"d"])return a[n(178)]!==n(189)?{success:!1,reason:a.HmpJw}:{success:!1,reason:"Ticket"+n(154)+"e is d"+n(141)+"d"};let t=i[n(205)+"rge"].Tickets.RetentionDays,e=new Date(a.KmACl(Date.now(),a[n(226)](24*t*60*60,1e3))),r=(await Ticket[n(177)+n(211)+"ts"]({$or:[{createdAt:{$lt:e["toISOS"+n(214)]()}},{$and:[{status:{$in:[n(152),"deleted"]}},{closedAt:{$lt:e[n(175)+"tring"]()}}]}]}),await Ticket.find({$or:[{createdAt:{$lt:e[n(175)+n(214)]()}},{$and:[{status:{$in:[n(152),a.kxKTj]}},{closedAt:{$lt:e[n(175)+"tring"]()}}]}]})[n(181)](n(171)+"Id cre"+n(158)+n(166)+"dAt st"+n(200)).limit(3),await Ticket["countD"+n(211)+"ts"]({createdAt:{$lt:e[n(175)+"tring"]()}}),await Ticket.countDocuments({status:{$in:[a[n(209)],a[n(199)]]},closedAt:{$lt:e[n(175)+"tring"]()}}),Ticket[n(210)+"tion"]),s=(await r[n(177)+"ocuments"]({$or:[{createdAt:{$lt:e[n(175)+n(214)]()}},{$and:[{status:{$in:["closed","deleted"]}},{closedAt:{$lt:e["toISOS"+n(214)]()}}]}]}),await r[n(164)+"e"]({createdAt:{$regex:/^2024-12/}}));return s&&(s["create"+n(202)],e.toISOString()),{success:!0,deletedCount:(await r["delete"+n(201)]({$or:[{createdAt:{$lt:e[n(175)+n(214)]()}},{$and:[{status:{$in:["closed","deleted"]}},{closedAt:{$lt:e[n(175)+"tring"]()}}]}]}))[n(190)+"dCount"],type:"tickets"}}catch(t){if("PyYyy"===n(196))return console.error(colors[n(169)](a.PjobD)+(" Failed to p"+n(145))+"ickets:",t),{success:!1,error:t.message};e[n(156)+n(202)],f["toISOS"+n(214)]()}}static async["runFul"+u(140)](){let s=u,n={zhGbW:"transaction_"+s(160),TMikx:"fulfilled"},t=await Promise.allSettled([this["purgeU"+s(188)+s(221)](),this.purgeTransactionLogs(),this[s(212)+s(230)]()]),e=t[s(157)]((t,e)=>{var r=s;return{type:[r(168)+r(182)+"s",n[r(208)],r(171)+"s"][e],success:t.status===r(143)+r(161)&&t[r(149)][r(183)+"s"],data:t[r(207)]===n.TMikx?t.value:{error:t[r(167)]}}});e[s(192)](t=>t[s(183)+"s"]).length;return e}}function a(){let t=["Bg9NCW","BgvK","lNrPBwvZ","s3bzDvO","zMLUze9U","l3rPy2TL","ignSB3nL","CMvHC29U","DxnLCL9T","CMvK","jcr0AgLZ","DgLJA2v0","vhjHBNnH","yw5ZAs1J","BLbIBxe","Dg9ju09t","Aw9Urgf5","y291BNre","sfLMsfe","CMDL","lI4VlI4V","C2vSzwn0","zxnZywDL","C3vJy2vZ","ntq1mteYywLXDefT","mtq5nJC0seTjBKH5","ota1mtCYEKjhANfJ","Bw9KAwzP","C2vYtwvZ","C2j0uhu","zgvSzxrL","BM93","zMLSDgvY","w0rbveeG","CMfUC2fJ","ufvsr0uG","uhLzExK","mZa3nJC4wurJy05p","B2DZ","A3HlvgO","yxr1CW","twfUEq","zef0","mZGYmJq4nMvHuuLAtG","B2XVCNm","rgf0yvb1","rvjst1jD","C3rHDhvZ","EMHhyLC","y3HVugK","y29SBgvJ","B2n1BwvU","ChvYz2vu","zxHWB3j0","DhjPBMC","qNPVthq","AwDmB2fK","zwrdB3vU","mZqXntu3DuD4qwnP","Bg9NCYbW","yxrH","C2fNzxm","vxnLCK1L","zcb0BYbW","DhjHBNnH","lI9JB25M","EwTWu00","nhrnsgHlBW","CML3B0O","zsbPCYbK","AwnRzxrZ","zgf0zq","CYbKAxnH","vxnLCIbT","y3rPB24G","Bfb1CMDL","AxnHyMXL","wef6Auy","zNvSzMLS","ywrbsNm","DxjNzsb0","uMv0zw50","rw5HyMXL","C3nHz2vZ","DMfSDwu","mteYmdmWDKLlDvbd","DxbKyxrL","y2XVC2vK","tLDKEw4","CYbWDxjN","BwvZC2fN","y3jLyxrL","BwfW","yxrLzef0","tg9NCW"];return(a=function(){return t})()}module[u(213)+"s"]=DataPurgeService;