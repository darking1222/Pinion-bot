let C=b,{ActionRowBuilder,EmbedBuilder,ButtonBuilder,ButtonStyle,ModalBuilder,TextInputBuilder,TextInputStyle,MessageFlags}=((()=>{for(var e=b,t=a();;)try{if(649929==-parseInt(e(308))*(parseInt(e(277))/2)+-parseInt(e(234))/3*(parseInt(e(373))/4)+parseInt(e(188))/5+parseInt(e(297))/6+-parseInt(e(388))/7+parseInt(e(125))/8+parseInt(e(145))/9)break;t.push(t.shift())}catch(e){t.push(t.shift())}})(),require("discord.js")),{getConfig,getLang}=require("../core/configLoader.js"),{getFormattedReason,replacePlaceholders,deferIfNeeded,replyOrFollowUp,safeInteractionResponse}=require("./ticketUtils.js"),sendDMEmbedAndTranscript=require("./tick"+C(238)+C(371)+C(215)).sendDMEmbedAndTranscript,Ticket=require("../../models/tickets"),notifyWatchers=require(C(292)+"etWatc"+C(186)+"s").notifyWatchers,config=getConfig(),lang=getLang();function getArchiveCategoryId(n,e){var i=C,r={wnHRY:function(e,t){return e===t},hvawQ:"glKAg"},e=e["Archiv"+i(320)+"ory"];if(Array[i(295)+"y"](e)){for(let t of e)if(t&&""!==t&&!r[i(203)](t,"CATEGO"+i(254))){let e=n[i(416)+"ls"].cache[i(340)](t);if(e)return t}}else if(e&&""!==e&&e!=="CATEGO"+i(254)){if(r[i(210)]===r.hvawQ)return e;e.push(g[i(197)+"sionOverwrites"][i(402)](h,{ViewChannel:!0,SendMessages:!1,ReadMessageHistory:!0,AttachFiles:!1,EmbedLinks:!1}))}return null}let TICKET_STATES={OPEN:C(400),CLOSED:"closed",DELETING:"deleting",DELETED:"deleted"};function b(r,e){let o=a();return(b=function(e,t){e-=103;let n=o[e];void 0===b.HcWAwg&&(b.pgqlpn=function(r){let a="",n="";for(let e=0,t,n,i=0;n=r.charAt(i++);~n&&(t=e%4?64*t+n:n,e++%4)&&(a+=String.fromCharCode(255&t>>(-2*e&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(let e=0,t=a.length;e<t;e++)n+="%"+("00"+a.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(n)},r=arguments,b.HcWAwg=!0);var e=e+o[0],i=r[e];return i?n=i:(n=b.pgqlpn(n),r[e]=n),n})(r,e)}async function setArchivePermissions(e,t,n){var i,r=C,a=[],o=(a[r(394)](e[r(197)+"sionOv"+r(348)+"es"][r(402)](e[r(346)][r(114)][r(354)+"ne"],{ViewChannel:!1})),await e.guild.members[r(229)](n)[r(194)](()=>null));o&&a.push(e["permis"+r(141)+r(348)+"es"][r(402)](n,{ViewChannel:!0,SendMessages:!1,ReadMessageHistory:!0,AttachFiles:!1,EmbedLinks:!1}));for(i of t[r(237)+"tRole"]){var s=e.guild.roles.cache.get(i);s&&a[r(394)](e[r(197)+r(141)+r(348)+"es"][r(402)](s,{ViewChannel:!0,SendMessages:!0,ReadMessageHistory:!0,AttachFiles:!0,EmbedLinks:!0}))}await Promise["allSet"+r(107)](a)}async function handleArchiveProcess(t,i,e,r){var a=C,s={BGDzl:"Error "+a(162)+"ng cha"+a(351)+a(211)+"ions:"},c=getArchiveCategoryId(t.guild,r);if(!(c&&t.channel.parentId===c)&&c)try{if(a(248)!==a(311)){let e=await t.guild.channels[a(229)](c).catch(()=>null);if(e&&4===e[a(196)]){if(a(103)!==a(103))return i;await t[a(416)+"l"].setParent(e.id)}else console[a(227)](a(178)+"e category "+c+(a(290)+a(336))+"keepin"+a(381)+"et in current loca"+a(223))}else j[a(384)+"ponents"]((new k)[a(359)+"tomId"]("ticketarchive-"+l+"-"+m.Type[a(170)+"rCase"]()).setLabel(n.Name)[a(328)+"le"](o)[a(323)+"ji"](p[a(148)]))}catch(e){console[a(136)](a(307)+"moving chann"+a(378)+"archiv"+a(132)+a(330),e)}try{"eFyvy"===a(192)?r.push(s[a(197)+a(141)+a(348)+"es"].edit(c,{ViewChannel:!0,SendMessages:!0,ReadMessageHistory:!0,AttachFiles:!0,EmbedLinks:!0})):await setArchivePermissions(t[a(416)+"l"],r,e.userId)}catch(e){console.error(s[a(321)],e)}await sendArchiveEmbed(t,i,e.userId),await safeInteractionResponse(t,lang.Tickets.Archive)}async function handleTicketClose(r,a,o,c=null,d=null){let g=C,f={fkWXB:"ticket"+g(353)+"ed",OUyWN:"SendMessages",AelMh:g(164)+g(414),qLynI:g(149)+g(163)+g(282),oWrbu:function(e,t){return e!==t},pybHq:function(e,t,n,i){return e(t,n,i)},QDZcm:g(360)+" not f"+g(349),IkCvk:function(e,t){return e!==t},LyNUK:function(e,t){return e||t},gBowO:function(e,t){return e===t},rQatA:function(e,t,n){return e(t,n)},BkEiq:function(e,t){return e===t},AOujz:function(e,t){return e===t},ulDqf:function(e,t){return e===t},cYyNP:function(e,t,n,i,r){return e(t,n,i,r)},izPnK:function(e,t,n,i){return e(t,n,i)},HHstS:function(e,t){return e!==t},Mtrpe:g(274)+":closed",ltzzm:function(e,t){return e&&t},FaaMc:g(176)};await deferIfNeeded(a);try{if(f[g(267)]("vtkMV",g(131))){let e=await Ticket[g(391)+"e"]({ticketId:o});if(e){let t=config["Ticket"+g(281)][e[g(274)+g(182)]];if(t){if(t.RestrictDeletion)if(!a[g(175)].roles[g(180)].some(e=>t[g(237)+g(119)].includes(e.id))){if(!f[g(369)](g(411),"DXaHb"))return void await safeInteractionResponse(a,"You do"+g(319)+g(358)+"rmission to "+g(298)+g(344)+"icket.",!0);c=d[g(360)+g(281)][f.ticketType]}let n=c,i=d;if(a.isCommand()){let e=a[g(404)+"s"][g(240)+"ing"](g(387)),t=a.options[g(240)+"ing"]("custom_reason");f[g(268)](e,t)&&(n=e,i=t)}if(e[g(334)]===TICKET_STATES.DELETING||f[g(370)](e[g(334)],TICKET_STATES[g(363)+"D"]))await f.rQatA(safeInteractionResponse,a,lang.Tickets.Deleting);else{var h=f.BkEiq(a[g(365)]?.id,r[g(365)].id)&&f.AOujz(n,g(261)+"ponse after alert"),T=getArchiveCategoryId(a[g(346)],t);if(f[g(156)](e[g(334)],TICKET_STATES[g(246)])&&!h){if(g(313)!==g(108))return void(T?await f.cYyNP(handleArchiveProcess,a,o,e,t):await f[g(185)](processTicketDeletion,r,a,e));o[g(394)]({id:c.id,allow:["SendMe"+g(226),"ViewCh"+g(294),g(255)+g(350),"EmbedL"+g(414),"ReadMessageHistory"]})}var y=await Ticket[g(391)+"eAndUpdate"]({ticketId:o,status:{$nin:[TICKET_STATES.DELETING,TICKET_STATES.DELETED,TICKET_STATES[g(246)]]}},{status:TICKET_STATES.CLOSED,closedAt:new Date,closedBy:a.user?.id||a[g(422)]?.id,closeReason:n,customCloseReason:i},{new:!0});if(!y){if(!f[g(337)](g(405),g(405)))return;e["addonL"+g(280)]["getEventMana"+g(420)]()[g(228)+"fe"](f[g(207)],{ticket:t[g(333)+"ct"](),deletedBy:n.user||i[g(422)],guild:h[g(346)],forceDelete:T,channelName:"Unknown (channel not found)"})}if(notifyWatchers(r,y.toObject(),"closing",{closedBy:a[g(365)]?.id||a.author?.id,reason:getFormattedReason(n,i),excludeUser:a.user?.id||a[g(422)]?.id}),global.addonLoader&&global.addonLoader["getEventMana"+g(420)]()[g(228)+"fe"](f.Mtrpe,{ticket:y.toObject(),ticketType:t,closeReason:n,customReason:i,closedBy:a[g(365)]||a.author,guild:a[g(346)],isAutoAlert:h}),f.ltzzm(T,!h))await f.cYyNP(handleArchiveProcess,a,o,y,t);else{let e=h;await processTicketDeletion(r,a,y,e)}}}else await safeInteractionResponse(a,"Ticket type config"+g(272)+g(276)+g(398),!0)}else console[g(136)](g(397)+"ket found in the d"+g(160)+g(140)+g(153)+"tId: "+o),await f.pybHq(safeInteractionResponse,a,f.QDZcm,!0)}else{var e=c.guild[g(114)].cache.get(d);e&&i[g(394)]({id:e.id,allow:[f[g(139)],g(239)+g(294),"AttachFiles",f.AelMh,f.qLynI]})}}catch(e){g(176)!==f[g(342)]?(T=k[l[g(217)]["toUppe"+g(345)]()])&&s[g(384)+g(326)+"s"]((new t).setCustomId(g(274)+"archive-"+u+"-"+v[g(182)][g(170)+g(345)]()).setLabel(w[g(241)])[g(328)+"le"](T)[g(323)+"ji"](e[g(148)])):(console[g(136)]("Error handli"+g(144)+"ket closing:",e),h=e.message?.includes(g(197)+g(110))?g(264)+"sion error o"+g(393)+"d whil"+g(368)+g(189)+g(179)+g(256)+g(191)+"heck bot per"+g(224)+"ns.":e.message?.[g(325)+"es"]("not found")?"The ti"+g(143)+"r chan"+g(310)+g(285)+g(151)+"ound.":g(300)+"or occurred "+g(379)+g(235)+g(392)+"ticket"+g(135)+g(385)+" again later.",await safeInteractionResponse(a,h,!0))}}function a(){let e=["thHPy1i","rMfHtwm","vgL0Bgu","DgHPCYb0","CKnHC2u","z3vPBgq","ignOyw5U","zxj3CML0","B3vUzc4","rMLSzxm","BM5LBcbW","CMfS","oMrLBgv0","zxzLCNLV","zwfZB24","zsbMB3iG","DgHLignV","yxzLihbL","C2v0q3vZ","vgLJA2v0","sw1Hz2u","wNbJs24","revmrvrf","y3rezwXL","DxnLCG","yxjJAgL2","CMvWBhK","zsbJBg9Z","swTdDMS","z0jVD08","C2nYAxb0","C2LUzYb0","ngP4vun3vG","DfjLyxnV","CejuBgu","y3rPB24G","DNjey1i","zwWGDg8G","D2HPBguG","vgH1BwjU","zYb0AwnR","BMCGy2HH","zM9SBg93","ywrKq29T","C2uGDhj5","B24GDg8G","CMvHC29U","ntmYmtm0neD5ww9YDG","C2vUza","sNb3D0C","zMLUze9U","zYb0AguG","y2n1CNjL","ChvZAa","zYbYzxbS","EujpwLO","tM8GDgLJ","zM91BMqU","rgvSzxrP","B3bLBG","B25uAw1L","zwrPDa","yxrPB24G","B3b0Aw9U","DLzUsuy","C2v0vgL0","AM9PBG","C2v0vgLT","zwfZB25Z","A2v0ihjL","rfHHsgi","ywrKB25m","BM5LBcbM","Aw5RCW","zgfSoG","y2HHBM5L","rgvZy3jP","ww5UBuW","zxrHyMXL","z2vY","Aw9UCZO","yxv0Ag9Y","igfNywLU","zgvMzxjv","v1bNzMS","uMvVCgvU","zxiU","z2v0vgv4","DgXLza","yMH1BLC","E3jLyxnV","C2LVBG","Bw92Aw5N","ihrOzsbK","zgvSzxrL","CM9Szxm","Dg9Tswq","zw1IzwrZ","CMvWBgLL","y3vYCMvU","DfjVBgu","uLPgB20","DcbVDxrZ","Bgv0Aw9U","EhrUzNy","zMLLBgrZ","ndeWnZa0ohLrCLzbDq","zurLC2LN","A2v0igrL","y0f5r2S","AguGDgLJ","BM5LBcbU","AwzsD2O","zsbJyxrL","zw50","r1n5BNC","lIbqBgvH","zxjYB3i","zYbMB2XS","BMzPz3vY","t1v5v04","zsb3AxrO","C2LVBK92","tM8Gy2HH","y2TLDcbV","BMCGDgLJ","otK1mtm5ovzkCfzyra","B2fxqw8","CMvWBgfJ","rw1VAMK","uMvHze1L","u3vJy2vZ","DcbIzsbM","C2v0sw1H","ihrPy2TL","oMnSB3nL","C2v0rgvZ","DwXeCwy","vw5HyMXL","DgLUzYb0","zgvSzxrP","yxrHyMfZ","zM9YrwfJ","DxbKyxrP","C3nHz2vi","rw1Izwrm","CM1PC3nP","y3jPChrP","ALnKzNO","B3qGzgvS","rvPJv2K","Dg9mB3DL","BeLK","uunxyK8","zM9YihrP","v2LfEgO","BwvTyMvY","thvxDeu","yw5UzwXj","qxjJAgL2","zsb0AwnR","y2fJAgu","q2HHBM5L","vhLWzq","q2XVC2vs","B0fNDuq","AxPqBKS","AgvYCY5Q","yxj5","nJeYmtq1mhPfrfrltq","Aw5NihrO","C2v0","zwfZzsbJ","se9sChO","rgvSzxrL","y2f0y2G","r3jLzw4","DhLWzq","CgvYBwLZ","ignSB3nL","Du1eD1e","CNKG","y2f0zwDV","Aw4GBgf0","D25iuLK","C2v0ugfY","BMqP","zwfZzsb0","zMTxwei","t1D4sMe","qNv0Dg9U","AhzHD1e","zxjTAxnZ","BNrnyw5H","AxmGDw5K","ueHSC3m","CY5QCW","DgvYBwLU","u3r5Bgu","q2f0zwDV","zgf0zq","Dg9WAwm","rM9VDgvY","C2v0rM9V","DgLVBG","BwLZC2LV","BMfTzq","C3nHz2vZ","D2fYBG","zw1PDfnH","zMv0y2G","E3rPBwv9","v1jnEgO","CMfUC2nY","B3DU","mtKWmJa4nfzrv0XmrG","y2XVC2LU","DMfSDwvZ","u3vWCg9Y","zxruCMfU","vMLLD0nO","z2v0u3rY","tMfTzq","CNLjra","DxnLCM5H","CNK6","DeLKoIa","q0Xpu0ve","vMfSDwu","B0P5Bei","zfPntgG","C2v0q29S","revmrvrj","AwnRzxqG","sw50zxjH","uLLFsuq","qxr0ywnO","zxqUifbS","zufUzfvW","CgrHDgu","C2v0tgfI","z2vUzxjH","tM8GCMvZ","ww91igrV","u2vJB25K","ugvYBwLZ","z3vPBgqG","DxjYzwqG","B1DYyNu","thLovuS","q291BNre","zwW6","uMvZDhjP","DxjHDgLV","ywLUigXH","DgLJA2v0","uhjPBwfY","BIbUB3qG","mZa4nZrksgvXzeK","DgL0Bgu","Axb0oG","B2fKzxi","vhLWzxm","Axn0B3j5","igzVCIb0","ihr5CguG","DwXKig5V","s2j6sui","ChjVy2vZ","zwzPBMvK","ywLS","ig5VDcbM","rxbOzw1L","lI90AwnR","ChrPB24","yw5UzwW","AxnbCNjH","vgv4Da","odu0ntq0DKjlDezZ","y2XVC2uG","y2XVC2vs","qw4GzxjY","CMvVCgvU","DxnLCKLK","zxHWB3j0","yMnbBe8","BIaOy2HH","B3vUzcb3","rxjYB3iG","nJfptNvctKq","tMziDwO","BMvSignV","vgjVANK","zxqGDhLW","rertv1C","B3iGB2nJ","zffyA2O","B3j5","ruDyEeq","Aw5N","ig5VDcbO","zunHDgvN","qKDeEMW","zdOG","C2v0rw1V","vgr2rfe","Aw5JBhvK","Cg9Uzw50","A2v0lIbq","C2v0u3r5","C29Uig1V","z29YEtO","qMf6D2K","vNziC1e","Dg9pyMPL","C3rHDhvZ","AMPtELG","B3vUzcWG","seHZDfm","u2v0DgLU","AxrOignO","z2v0"];return(a=function(){return e})()}async function handleDeleteTicket(e,t,n){var i=C,r={KbzIB:"Intera"+i(376)+i(265)+i(213)+"efined",ZFZeU:function(e,t){return e!==t},SZCPM:"Ticket"+i(290)+"ound.",GSynw:function(e,t,n,i){return e(t,n,i)}};await deferIfNeeded(t);try{var a=await Ticket[i(391)+"e"]({ticketId:n});if(!a){if(!r.ZFZeU("wRYIQ","wRYIQ"))return console.error(i(397)+"ket found in"+i(112)+"atabase with ticke"+i(245)+n),void await safeInteractionResponse(t,r.SZCPM,!0);n[i(136)]("Error "+i(111)+i(347)+i(378)+i(366)+i(132)+"gory:",r)}if(!t.member){if("PHlss"!==i(214))throw new t(r[i(286)]);t.member=await t[i(346)][i(175)+"s"].fetch(e[i(365)].id)}await r[i(134)](processTicketDeletion,e,t,a)}catch(e){console[i(136)]("Error handling delete ticket:",e),await safeInteractionResponse(t,i(300)+i(314)+i(266)+i(379)+i(287)+i(372)+i(129)+i(127)+i(122)+i(135)+"se try"+i(423)+" later.",!0)}}async function processTicketDeletion(s,c,d,u=!1){let g=C,f={TdvDQ:g(307)+g(260)+"ting transcr"+g(279),WiExj:"custom_reason",OWxJa:function(e,t){return e!==t},cAyGk:"delete",NeKvp:g(181)+"l is n"+g(168)+g(419)+".",oaWAo:function(e,t){return e===t},EGXxD:g(184),VhZst:g(253)+"ction "+g(265)+g(213)+g(288),NtSbI:function(e,t){return e&&t},Bazwi:"EZcWi",riDkH:g(335),YLAHV:function(e,t,n){return e(t,n)},bcAlO:"Failed to fetch me"+g(226)+g(283)+"ranscript:",uMDwQ:"#FF0000",fGwKH:function(e,t,n){return e(t,n)},Yovwv:function(e,t,n,i){return e(t,n,i)},YnnmL:"An error occ"+g(266)+g(379)+"processing t"+g(129)+g(327)+"lease try ag"+g(273)+"ter."};try{if(c.member||(c.member=await c.guild[g(175)+"s"].fetch(s[g(365)].id)),!c.guild)throw new Error(f.VhZst);let o=c[g(175)].roles[g(180)].map(e=>e.id),e=config.TicketTypes[d.ticketType];if(f.NtSbI(!u,e)&&e[g(271)+g(364)+"tion"])if(f[g(331)]!==g(169))o[g(155)+"cription"](e[g(417)+"ption"][g(407)]("\n")[g(147)+"e"]("{user}",w.user[g(243)+"me"])[g(147)+"e"]("{userTag}","<@"+v.userId+">").replace("{reason}",l));else if(!e.SupportRole.some(e=>o[g(325)+"es"](e))){if(f.riDkH!==g(249))return void await safeInteractionResponse(c,g(262)+g(319)+"ave pe"+g(165)+g(386)+"delete this "+g(274)+".",!0);o[g(136)](g(157)+" to de"+g(216)+"e tick"+g(312)+g(356)+"ticket "+e),w=v[g(236)](l[g(360)+g(281)])[0]}if(d.status===TICKET_STATES.DELETING||d[g(334)]===TICKET_STATES[g(363)+"D"])return void await safeInteractionResponse(c,lang[g(360)+"s"][g(399)+"ng"]);const w=await Ticket["findOn"+g(257)+g(219)]({ticketId:d.ticketId,status:{$nin:[TICKET_STATES[g(251)+"NG"],TICKET_STATES[g(363)+"D"]]}},{status:TICKET_STATES.DELETING},{new:!0});if(!w)return void await safeInteractionResponse(c,lang.Tickets[g(399)+"ng"]);const v=await s.channels[g(229)](d[g(416)+g(171)])[g(194)](()=>null);if(v){var t=f.YLAHV(parseInt,config["Ticket"+g(338)+"gs"]["Deleti"+g(401)],10)||0;let a;try{var n=await v.messages.fetch({limit:100});a=n.filter(e=>!e.author.bot)}catch(e){console.warn(f[g(304)],e),a=new Map}var i,r=async()=>{let n=g,e={yBOZZ:n(387),TSWgl:f[n(174)]};if(f.OWxJa("NfHuj",n(309))){var t=f.options["getStr"+n(318)](e[n(396)]),i=o[n(404)+"s"].getString(e.TSWgl);(t||i)&&(v=t,l=i)}else try{var r;sendDMEmbedAndTranscript(s,c,w,f[n(128)],a).catch(e=>{var t=n;console.error(f[t(324)],e)});v.deletable?(await v[n(113)](),r=await Ticket["findOneAndUp"+n(219)]({ticketId:d[n(274)+"Id"]},{status:TICKET_STATES[n(363)+"D"],deletedAt:new Date},{new:!0}),global[n(412)+n(280)]&&r&&global["addonL"+n(280)]["getEve"+n(212)+n(420)]().emitSafe("ticket"+n(353)+"ed",{ticket:r[n(333)+"ct"](),deletedBy:c.user||c[n(422)],guild:c.guild,forceDelete:u,channelName:v[n(225)]})):console[n(136)](f.NeKvp)}catch(e){console[n(136)](n(307)+n(159)+"ng the"+n(347)+n(270),e),f[n(146)](e.code,10003)&&(f[n(146)]("oAguD",f[n(317)])?(t=await Ticket.findOneAndUpdate({ticketId:d.ticketId},{status:TICKET_STATES.DELETED,deletedAt:new Date},{new:!0}),global[n(412)+n(280)]&&t&&(f[n(208)]("JQTnk","amNpl")?global.addonLoader.getEventManager()[n(228)+"fe"](n(274)+":deleted",{ticket:t[n(333)+"ct"](),deletedBy:c[n(365)]||c[n(422)],guild:c.guild,forceDelete:u,channelName:"Unknow"+n(305)+n(130)+"ot fou"+n(205)}):d[n(136)]("Error "+n(260)+n(158)+n(232)+n(279),u))):u.setFooter({text:f.Footer.Text,iconURL:o[n(221)].Icon||null}))}};0<t?(i=(new EmbedBuilder)[g(155)+"cription"](lang.Tickets[g(193)+g(269)+g(233)].replace(g(230),t)).setColor(f[g(199)]),await v.send({embeds:[i]}),setTimeout(r,1e3*t)):await r()}else await f.fGwKH(safeInteractionResponse,c,"Channel not found."),await Ticket["findOneAndUp"+g(219)]({ticketId:d[g(274)+"Id"]},{status:TICKET_STATES[g(363)+"D"],deletedAt:new Date},{new:!0})}catch(e){console[g(136)](g(307)+g(287)+g(372)+g(252)+g(159)+"on:",e),await f.Yovwv(safeInteractionResponse,c,f[g(418)],!0)}}async function sendArchiveEmbed(e,i,t){const r=C,n={WRMxj:"{user}",LxicR:r(109)+"n}"},a=await Ticket[r(391)+"e"]({ticketId:i});let o;var s;e[r(416)+"l"][r(220)]&&(s=e.channel.topic.split(" "),o=config[r(360)+r(281)][s[1]]),(o=!o&&a?config[r(360)+r(281)][a["ticket"+r(182)]]:o)||(console.error("Unable to de"+r(216)+"e ticket type for ticket "+i),o=Object[r(236)](config[r(360)+"Types"])[0]);const c=config.ArchiveDesign.Embed,l=new EmbedBuilder,d=a["customCloseR"+r(355)]||(a[r(299)+r(355)]?getFormattedReason(a.closeReason):config.TicketSettings[r(183)+r(409)]["Defaul"+r(374)+"n"]);c.Title&&l[r(406)+"le"](c[r(343)]),c[r(417)+r(293)]&&l["setDes"+r(166)+"on"](c[r(417)+r(293)][r(407)]("\n")[r(147)+"e"](n[r(231)],e.user[r(243)+"me"])[r(147)+"e"]("{userTag}","<@"+a[r(302)]+">")[r(147)+"e"](n[r(341)],d)),c.Color&&l[r(250)+"or"](c.Color),c[r(221)]&&c.Footer[r(296)]&&l[r(222)+"ter"]({text:c.Footer[r(296)],iconURL:c.Footer.Icon||null}),c[r(361)]&&l[r(152)+"ge"](c[r(361)]),c[r(380)+r(289)]&&l.setThumbnail(c.Thumbnail);let u=new ActionRowBuilder,g=Object[r(236)](c[r(209)+"s"]),f={PRIMARY:ButtonStyle[r(275)+"y"],SECONDARY:ButtonStyle[r(263)+r(187)],SUCCESS:ButtonStyle[r(150)+"s"],DANGER:ButtonStyle.Danger,LINK:ButtonStyle.Link};g[r(161)+"h"](e=>{var t=r,n=f[e.Style.toUpperCase()];n&&("cxsvU"===t(390)?(a=o,c=l):u["addCom"+t(326)+"s"]((new ButtonBuilder)["setCus"+t(115)](t(274)+"archive-"+i+"-"+e.Type[t(170)+t(345)]())[t(259)+"el"](e.Name).setStyle(n)[t(323)+"ji"](e[t(148)])))}),await e[r(416)+"l"][r(389)]({embeds:[l],components:[u]})}async function handleReopenTicket(e,t,i){let l=C,d={ZpcKn:"xcLBv",QCWbO:"SendMe"+l(226),xtnfv:l(164)+"inks",vrDcR:function(e,t){return e!==t},dQXkj:"bKHBZ",YSeOm:"Error moving chann"+l(378)+l(201)+l(244),RZFom:l(239)+"annel",MnlXL:"An error occurred while "+l(301)+l(189)+"e ticket. Pl"+l(206)+"ry aga"+l(202)+"er."};try{const g=await Ticket[l(391)+"eAndUpdate"]({ticketId:i},{status:TICKET_STATES.OPEN,closedAt:null},{new:!0});if(!g)return console.error(l(397)+"ket found in the database with"+l(153)+"tId: "+i),void await t.reply({content:"Ticket not found.",flags:MessageFlags.Ephemeral});let a=await e.channels.fetch(g.channelId);if(!a)return console[l(136)](l(142)+l(413)+l(306)+l(339)+l(177)+l(322)+g["channe"+l(171)]),void await t[l(367)]({content:"Channel not "+l(398),flags:MessageFlags["Epheme"+l(352)]});var r=config[l(360)+l(281)][g[l(274)+"Type"]];if(!r)return console[l(136)]("No ticket type found in "+l(357)+l(138)+l(403)+l(173)+"cketType: "+g.ticketType),void await t[l(367)]({content:l(360)+l(284)+"configuratio"+l(276)+l(398),flags:MessageFlags[l(291)+"ral"]});var u=(await a.messages[l(229)]({limit:100})).find(e=>0<e[l(116)].length&&e[l(116)][0][l(278)]===config["Archiv"+l(126)+"n"].Embed.Title);if(u&&await u.delete().catch(console[l(136)]),r[l(218)+l(242)])if(d[l(377)]("wWjCr",d[l(315)]))try{let e=await a.guild[l(416)+"ls"][l(229)](r.CategoryID).catch(()=>null);e&&4===e.type?await a[l(204)+l(133)](r["Catego"+l(242)]):(console[l(227)]("Catego"+l(200)+r[l(218)+"ryID"]+l(290)+"ound, "+l(111)+l(153)+l(121)+"ide of categ"+l(316)),await a[l(204)+l(133)](null))}catch(e){console[l(136)](d.YSeOm,e),await a["setPar"+l(133)](null)}else{let e=d.channel.topic.split(" ");g=a["Ticket"+l(281)][e[1]]}else"dMcoo"===l(167)?i[l(227)](l(178)+l(132)+"gory "+d+l(290)+"ound, keeping ticket in "+l(118)+"t loca"+l(223)):await a[l(204)+"ent"](null);let s=[{id:g.userId,allow:[d.QCWbO,d[l(120)],l(255)+"Files",d[l(123)],"ReadMessageH"+l(282)]},{id:a.guild[l(114)][l(354)+"ne"].id,deny:[d.QCWbO,l(239)+"annel"]},{id:e.user.id,allow:[d[l(172)],l(239)+l(294)]}],c=(r[l(237)+l(119)].forEach(e=>{var t=l,i={pBTle:"ticket"+t(154)+"d"},r=a.guild[t(114)][t(180)].get(e);r&&("xcLBv"!==d[t(362)]?s[t(412)+t(280)]["getEventMana"+t(420)]().emitSafe(i[t(375)],{ticket:c[t(333)+"ct"](),ticketType:n,closeReason:o,customReason:p,closedBy:q.user||e[t(422)],guild:i.guild,isAutoAlert:r}):s[t(394)]({id:r.id,allow:[d.QCWbO,t(239)+"annel",t(255)+t(350),d[t(123)],t(149)+t(163)+"istory"]}))}),await a["permis"+l(141)+l(348)+"es"][l(190)](s),(new EmbedBuilder).setTitle(lang.Tickets[l(360)+l(104)+l(343)])[l(250)+"or"](l(195))["setDes"+l(166)+"on"](replacePlaceholders(lang[l(360)+"s"].TicketReopenDescription,{userId:t[l(365)].id}))[l(408)+"estamp"]());await a[l(389)]({embeds:[c]}),await t[l(367)]({content:lang.Tickets["Ticket"+l(104)],flags:MessageFlags["Epheme"+l(352)]})}catch(e){console[l(136)](l(307)+"handling tic"+l(410)+"opening:",e),t[l(117)+"d"]||t.deferred?"VvHsQ"!==l(332)?i[l(136)](l(307)+l(162)+l(382)+l(351)+l(211)+l(421),d):await t[l(383)+"Up"]({content:"An error occurred "+l(379)+"reopen"+l(189)+"e tick"+l(256)+"ease try aga"+l(202)+l(105),flags:MessageFlags.Ephemeral}).catch(e=>console[l(136)](l(307)+"sendin"+l(137)+"ow-up:",e)):await t[l(367)]({content:d.MnlXL,flags:MessageFlags[l(291)+"ral"]})[l(194)](e=>console.error("Error sendin"+l(395)+"y:",e))}}async function handleCloseReasonModal(t,n){var i=C,r={iMUiT:function(e,t,n,i,r,a){return e(t,n,i,r,a)},CQvlK:function(e,t,n,i){return e(t,n,i)},EnVET:function(e,t,n,i){return e(t,n,i)},OPzrq:"An err"+i(314)+i(266)+"while "+i(235)+i(392)+i(274)+". Plea"+i(385)+i(423)+"."};try{await t[i(424)+i(258)]();var e=t[i(124)][i(106)+"tInput"+i(247)]("closeReason");await r.iMUiT(handleTicketClose,t.client,t,n,null,e)}catch(e){console.error(i(307)+"handling close rea"+i(329)+i(415),e);try{await r.CQvlK(handleTicketClose,t.client,t,n)}catch(e){console[i(136)](i(307)+"handling fallback "+i(274)+i(198)+":",e),await r.EnVET(safeInteractionResponse,t,r.OPzrq,!0)}}}module[C(303)+"s"]={handleTicketClose:handleTicketClose,handleDeleteTicket:handleDeleteTicket,processTicketDeletion:processTicketDeletion,sendArchiveEmbed:sendArchiveEmbed,handleReopenTicket:handleReopenTicket,handleCloseReasonModal:handleCloseReasonModal};