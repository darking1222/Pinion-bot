let a7=b,UserData=((()=>{for(var e=b,t=a();;)try{if(504547==+parseInt(e(257))+-parseInt(e(269))/2+parseInt(e(259))/3*(parseInt(e(202))/4)+parseInt(e(228))/5*(-parseInt(e(210))/6)+-parseInt(e(256))/7+parseInt(e(265))/8*(parseInt(e(246))/9)+-parseInt(e(248))/10)break;t.push(t.shift())}catch(e){t.push(t.shift())}})(),require(a7(252)+a7(239)+a7(215)+a7(253))),Invite=require(a7(252)+"els/inviteSchema.js"),observeAsync=require("./core/perfM"+a7(216)).observeAsync;class LeaderboardCache{constructor(){var e=a7,t="5|0|4|2|3|1"[e(241)]("|");let a=0;for(;;){switch(t[a++]){case"0":this.CACHE_DURATION=12e4;continue;case"1":this[e(214)+"CHE_SIZE"]=100;continue;case"2":this[e(275)+"oundUp"+e(238)+e(240)]=null;continue;case"3":this[e(229)+e(235)]=new Set;continue;case"4":this[e(196)+"OUND_UPDATE_INTERVAL"]=9e5;continue;case"5":this.cache=new Map;continue}break}}["getCac"+a7(276)](e,t,a=0,s=10){return e+"-"+t+"-"+a+"-"+s}["getCou"+a7(198)+a7(249)](e,t){return a7(281)+e+"-"+t}[a7(279)](e){var t=a7,e=this.cache.get(e);return e&&Date.now()-e[t(271)+t(251)]<this["CACHE_"+t(267)+"ON"]?e.data:null}[a7(217)](e,t){let a=a7;var s;this.cache.size>=this.MAX_CACHE_SIZE&&(s=Array.from(this[a(282)][a(209)+"s"]()).sort((e,t)=>e[1].timestamp-t[1][a(271)+a(251)])[0][0],this[a(282)][a(284)](s)),this.cache[a(217)](e,{data:t,timestamp:Date.now()})}async["getOrF"+a7(218)](a,e){var t=a7,s=this.get(a);if(s)return s;if(this["isUpda"+t(235)].has(a))return await new Promise(e=>{let t=()=>{this.isUpdating.has(a)?setTimeout(t,100):e()};t()}),this.get(a);this["isUpda"+t(235)][t(263)](a);try{var r=await e();return this.set(a,r),r}finally{this[t(229)+"ting"].delete(a)}}async[a7(247)+a7(266)+a7(212)+"s"](e,t=[a7(207)+"e","levels",a7(211)+"es",a7(208)+"s"]){let r=a7,i={Koptw:"YGyhN"},n=[];for(let s of t){for(let a=0;a<3;a++)if("YGyhN"===i.Koptw){let t=this.getCacheKey(e,s,a,5);this.get(t)||n[r(201)](this[r(204)+"eaderboardData"](e,s,a,5).then(e=>this[r(217)](t,e))[r(280)](e=>console.error("Failed"+r(277)+"eload "+s+r(195)+a+":",e)))}else this.cache=new i,this["CACHE_"+r(267)+"ON"]=12e4,this["BACKGR"+r(222)+"PDATE_INTERVAL"]=9e5,this["backgr"+r(270)+"dateTimer"]=null,this.isUpdating=new n,this[r(214)+"CHE_SIZE"]=100;let t=this[r(254)+"ntCacheKey"](e,s);this.get(t)||n[r(201)](this[r(236)+r(233)+"unt"](e,s)[r(227)](e=>this.set(t,e)).catch(e=>console[r(273)](r(220)+r(277)+"eload "+s+r(191)+":",e)))}await Promise.allSettled(n)}async["fetchL"+a7(243)+a7(261)+"ta"](e,t,a,s){let r=a7,i=a*s,n={balance:()=>observeAsync(r(203)+r(230),async()=>UserData["aggreg"+r(192)]([{$match:{guildId:e,$or:[{balance:{$gt:0}},{bank:{$gt:0}}]}},{$addFields:{totalBalance:{$add:[{$ifNull:[r(194)+"ce",0]},{$ifNull:["$bank",0]}]}}},{$sort:{totalBalance:-1}},{$skip:i},{$limit:s},{$project:{userId:1,totalBalance:1,_id:0}}],{allowDiskUse:!0})),levels:()=>observeAsync("lb.levels",async()=>UserData["aggreg"+r(192)]([{$match:{guildId:e,$or:[{level:{$gt:0}},{xp:{$gt:0}}]}},{$sort:{level:-1,xp:-1}},{$skip:i},{$limit:s},{$project:{userId:1,level:1,xp:1,_id:0}}],{allowDiskUse:!0})),messages:()=>observeAsync(r(264)+r(260),async()=>UserData[r(193)+"ate"]([{$match:{guildId:e,totalMessages:{$gt:0}}},{$sort:{totalMessages:-1}},{$skip:i},{$limit:s},{$project:{userId:1,totalMessages:1,_id:0}}],{allowDiskUse:!0})),invites:()=>observeAsync(r(255)+r(224),async()=>Invite[r(193)+"ate"]([{$match:{guildID:e}},{$group:{_id:r(225)+r(274),userId:{$first:r(225)+r(274)},invites:{$sum:r(272)}}},{$match:{invites:{$gt:0}}},{$sort:{invites:-1}},{$skip:i},{$limit:s},{$project:{userId:1,invites:1,_id:0}}],{allowDiskUse:!0}))};return n[t]()}async["fetchT"+a7(233)+"unt"](t,e){let a=a7,s={iVFNV:"$uses"},r={balance:()=>observeAsync(a(231)+a(234)+"ance",async()=>UserData[a(219)+"ocuments"]({guildId:t,$or:[{balance:{$gt:0}},{bank:{$gt:0}}]})),levels:()=>observeAsync("lb.count.lev"+a(189),async()=>UserData["countD"+a(200)+"ts"]({guildId:t,$or:[{level:{$gt:0}},{xp:{$gt:0}}]})),messages:()=>observeAsync("lb.count.mes"+a(260),async()=>UserData["countD"+a(200)+"ts"]({guildId:t,totalMessages:{$gt:0}})),invites:async()=>observeAsync(a(231)+"nt.invites",async()=>{var e=a;return(await Invite[e(193)+e(192)]([{$match:{guildID:t}},{$group:{_id:e(225)+e(274),invites:{$sum:s[e(232)]}}},{$match:{invites:{$gt:0}}},{$count:e(206)}],{allowDiskUse:!0}))[0]?.[e(206)]||0})};return r[e]()}[a7(245)+"ackgro"+a7(242)+a7(221)](e=[]){let t=a7,s={NFBKm:t(262)};this["backgroundUpdateTi"+t(240)]&&clearInterval(this["backgr"+t(270)+"dateTimer"]),this[t(275)+"oundUpdateTimer"]=setInterval(async()=>{let a=t;for(let t of e){if(s.NFBKm!==a(262))return s.data;this[a(247)+a(266)+a(212)+"s"](t).catch(e=>console[a(273)](a(197)+a(226)+a(243)+"oard u"+a(278)+"failed for guild "+t+":",e))}},this[t(196)+t(222)+"PDATE_INTERVAL"])}["stopBa"+a7(190)+a7(223)+a7(188)](){var e=a7;this[e(275)+e(270)+e(238)+"mer"]&&({WSPBW:function(e,t){return e(t)}}[e(258)](clearInterval,this.backgroundUpdateTimer),this["backgroundUp"+e(238)+"mer"]=null)}["cleanup"](){var e,t,a=a7,s=Date.now();let r=0;for([e,t]of this.cache.entries())s-t.timestamp>2*this[a(213)+a(267)+"ON"]&&(this[a(282)][a(284)](e),r++);r}[a7(237)+"ts"](){var e=a7;return{totalEntries:this.cache[e(250)],updating:this.isUpdating[e(250)],oldestEntry:Math.min(...Array[e(283)](this[e(282)][e(244)]())[e(205)](e=>e.timestamp)),newestEntry:Math[e(268)](...Array.from(this[e(282)][e(244)]())[e(205)](e=>e.timestamp))}}}function a(){let e=["B3rHBenV","BNqUyMfS","DgLUzW","zMv0y2Hu","z2v0u3rH","zgf0zvrP","zwXZl1vZ","BwvY","C3bSAxq","Dw5KvxbK","zwfKzxjI","DMfSDwvZ","C3rHCNrc","mtq0mtyYrLv4s1n2","ChjLBg9H","mtaYoduWmZbtAvPQr2y","zuTLEq","C2L6zq","yw1W","lI4VBw9K","lMPZ","z2v0q291","BgiUAw52","mZa2mJa1mNvgyvDbwa","otm3ntq1Efz6DNnp","v1nqqLC","mtqYndeYn3b0v2rgza","C2fNzxm","B2fYzerH","uwrUDwK","ywrK","BgiUBwvZ","ndK2wxDSALHI","zeXLywrL","rfvsqvrj","Bwf4","mta5mta0Au9eBefj","B3vUzfvW","DgLTzxn0","jhvZzxm","zxjYB3i","zxjjra","yMfJA2DY","AgvlzxK","ihrVihbY","CgrHDguG","z2v0","y2f0y2G","y291BNqT","y2fJAgu","zNjVBq","zgvSzxrL","DgvZ","zwXZ","y2TNCM91","ignVDw50","yxrL","ywDNCMvN","jgjHBgfU","ihbHz2uG","qKfds0Ds","qMfJA2DY","BNrdywnO","BvfkC3e","B2n1BwvU","ChvZAa","ngLXEwzvEa","BgiUyMfS","zMv0y2Hm","BwfW","Dg90ywW","yMfSyw5J","Aw52AxrL","zw50CMLL","mte0mdK5nNP6v09rua","BwvZC2fN","CMjVyxjK","q0fdsevF","tufyx0nb","zxjeyxrH","B25PDg9Y","C2v0","zxrJAa","y291BNre","rMfPBgvK","yxrLCW","t1vorf9v","BMrvCgrH","AxrLCW","jgLUDML0","B3vUzcbS","DgHLBG","mtbdDhrWtgK","AxnvCgrH","yw5Jzq","BgiUy291","AvzgtLy"];return(a=function(){return e})()}function b(r,e){let i=a();return(b=function(e,t){e-=188;let a=i[e];void 0===b.oWtPkA&&(b.ZSBzRB=function(r){let i="",a="";for(let e=0,t,a,s=0;a=r.charAt(s++);~a&&(t=e%4?64*t+a:a,e++%4)&&(i+=String.fromCharCode(255&t>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let e=0,t=i.length;e<t;e++)a+="%"+("00"+i.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(a)},r=arguments,b.oWtPkA=!0);var e=e+i[0],s=r[e];return s?a=s:(a=b.ZSBzRB(a),r[e]=a),a})(r,e)}let leaderboardCache=new LeaderboardCache;setInterval(()=>{leaderboardCache.cleanup()},12e4),module.exports=leaderboardCache;