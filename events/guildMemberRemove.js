let aA=b,{EmbedBuilder,AuditLogEvent,ButtonBuilder,ButtonStyle,ActionRowBuilder}=((()=>{for(var e=b,r=a();;)try{if(401421==-parseInt(e(469))*(-parseInt(e(498))/2)+parseInt(e(528))/3+-parseInt(e(545))/4*(parseInt(e(564))/5)+parseInt(e(572))/6*(parseInt(e(487))/7)+-parseInt(e(478))/8*(-parseInt(e(474))/9)+-parseInt(e(484))/10+parseInt(e(554))/11*(-parseInt(e(509))/12))break;r.push(r.shift())}catch(e){r.push(r.shift())}})(),require(aA(506)+"d.js")),moment=require(aA(446)+"-timezone"),UserData=require(aA(576)+"els/UserData"),GuildData=require(aA(576)+"els/guildDataSchema"),Ticket=require(aA(576)+aA(587)+"ckets"),Invite=require("../mod"+aA(483)+"viteSc"+aA(557)),getConfig=require(aA(551)+aA(562)+aA(494)+aA(566)+"er.js").getConfig,updateInviteRolesForUser=require("../utils/gui"+aA(430)+aA(496)+aA(447)).updateInviteRolesForUser,handleKickEvent=require(aA(551)+"ls/security/"+aA(524)+"keHandler.js").handleKickEvent,getLogChannel=require("../utils/handlers/messag"+aA(424)+aA(508)).getLogChannel,config=getConfig(),kickLogCache=require("../com"+aA(501)+"Moderation/moderation").kickLogCache,sentLeaveEmbeds=new Set;function parseTime(e){const r=aA,t=function(e,r){return e*r},a=e[r(559)](/^(\d+)([smhd])$/);if(!a)return 0;var n=parseInt(a[1]);switch(a[2]){case"s":return 1e3*n;case"m":return 60*n*1e3;case"h":return 60*n*60*1e3;case"d":return t(60*t(24*n,60),1e3);default:return 0}}let LEAVE_EMBED_RESET_INTERVAL=parseTime("5m");function a(){let e=["AfrLy3K","Bw9KzxjH","mtG3nMrZrMvttW","ru1cruq","BMCGAw52","rxjYB3iG","EgflDfC","qxv0B0rL","CMvHC29U","zs9JB25M","rgvSyxK","AxrLuM9S","zwnPzMLL","mtmXmZu2nLvrBfzKsa","q291BNrd","igG6Bw0G","BwfUzhmV","Euf2yxrH","zwzLBNC","BYbzwvLz","w0vsuK9s","zgLZy29Y","zwf2zsbT","lMPZ","nduXmteXmLvsAM1Nta","A3bxtxy","AgfUBMvS","zM9YBwf0","C2v0vgH1","uxbWz1K","tgvHDMvn","vgv4Da","rurjzwy","Aw52AxrL","y2fJAgu","C2v0q29S","zgvSzxrL","zMLUze9U","BwjUywLS","yw50Au51","se1kvxy","C2vUza","oMq+","odK2ndG3t1H4C21h","swnVBG","BwvTyMvY","Ag9Y","tMfTzq","AM9PBG","vgLTzxPV","DhDWsfG","tf9jra","C2vYvgLJ","q2zywum","BeLe","BMCGDxnL","DgfN","qKryBvG","yuHsrwi","C2v0vgL0","mtyYnhLnz2HVBW","y2HHBM5L","rw5HyMXL","twvTyMvY","BLrlEvq","zMv0y2Hb","lI4VDxrP","twrQvLG","tu0VreqV","mJjNqMzYExq","CMvWBgfJ","AuTjuwG","AgvTyq","y2f0y2G","Bwf0y2G","yw1W","C2vUzcbS","BhmVy29Y","DwrPDeXV","nJa5nw5fyMvXsW","i0zgmdaW","AwDmB2fK","ywLS","s2LJA0XV","q0HbtK5f","vgL0Bgu","z3vPBgq","mJeXog9yDML4va","q291BNq","zufUzfvW","zMXVB3i","lI4VBw9K","u3DTzgC","zgf0zq","zwf2ztO","vw5RBM93","CKLe","tgv2zwXP","tI9b","sw1Hz2u","zMv0y2G","ChjVy2vZ","zwXZl3rP","oNq+","q2HHBM5L","zxiGzgf0","teXlrvG","rw1Izwq","DxnLCM5H","Cg5N","DhfbBKe","vNjjEMW","vLHRz3m","uhrkvKS","zvv0AwXZ","C2LUzYbR","wKXIvM0","yxzHDgfY","y3jLyxrL","zMv0y2HP","BgqVAw52","zxHLy3v0","lcbzwvLz","zef0","zfrPBwvZ","oKq+","DgfTCa","AxrLihvZ","zxjYB3i","ChrPB24","DfnmqM8","zxnZywDL","uuzgtNG","ysbVBIbS","zuvNEeG","vgH1BwjU","Bw9Tzw50","zxmUANm","DhjPBq","vhLWzq","tu1ntsbe","AMLosLa","oLi+","tLDdtNy","DxnLCG","D2rmCeK","xsbgywLS","q3Pcuge","BM93","yw5UzwXj","AM9PBMvK","Bgvjwhq","yw5KBgvv","rM9VDgvY","Aw5NihvZ","yxrHt25m","BMDtExn0","r0Xqqw0","z2v0","mu9uwKTlrG","C2v0sw1H","wvnjseW","wvLzwq","qK9usa","mta4y0D5sMf2","A2v0CW","DxnLCW","y3jPChrP","ndC4nZa0uNzKEujf","oMy+","DgLTzxn0","A2v0CY9O","phq6","zwXZl2LU","mtiWmdG1mhHgtwD3zq"];return(a=function(){return e})()}async function saveUserRoles(r){const t=aA,a=function(e,r){return e===r},n="Error saving user roles:";try{var e=r.roles.cache.filter(e=>e.id!==r[t(571)].id).map(e=>e.id);await UserData.findOneAndUpdate({userId:r.id,guildId:r.guild.id},{roles:e},{upsert:!0,new:!0})}catch(e){if(a(t(467),"zZTpl")){let e=e[t(468)](j.id);k-e.timestamp<l&&(o=e.moderator,p=e[t(493)])}else console[t(438)](n,e)}}async function updateInviteUsage(e){var r=aA,t={LLKEX:function(e,r,t,a){return e(r,t,a)},IzvXA:r(490)+"updati"+r(489)+r(437)+"age:"};try{var a=await Invite[r(522)+"e"]({guildID:e.guild.id,"joinedUsers.userID":e.id});a&&(await Invite.updateOne({guildID:e.guild.id,inviteCode:a.inviteCode},{$inc:{uses:-1},$pull:{joinedUsers:{userID:e.id}}}),await t[r(591)](updateInviteRolesForUser,e.client,e.guild.id,a[r(518)+r(581)]))}catch(e){console[r(438)](t.IzvXA,e)}}async function sendLeaveMessage(i){let o=aA,s={ZLbVm:o(505)+"] Failed to "+o(561)+"eave message:",MSwzO:"IAmTg",QgNyM:o(440),eEgxH:function(e,r){return e!==r},BENfo:"HAXEh",CzBPa:"CHANNEL_ID",leIXt:function(e,r){return e===r},IoAaw:"Twusr",kpWMv:o(503),VrIzl:"EMBED",mqesX:"BOTH",YSIHL:function(e,r,t,a,n,i,o,s,u,c,l){return e(r,t,a,n,i,o,s,u,c,l)},odfUd:function(e,r){return e!==r},wdLpI:function(e,r,t,a,n,i,o,s,u,c,l,g){return e(r,t,a,n,i,o,s,u,c,l,g)},xaKtW:function(e,r){return e!==r},BoLHT:"Swmdg",yJsnU:"{userBanner}",iKIQh:function(e,r){return e===r}};if(config[o(515)+"essage"][o(547)+"d"]){let n=null;var u=config.LeaveMessage[o(589)+o(539)];if(Array.isArray(u))for(var e of u)if(s.MSwzO!==s.QgNyM){if(e&&""!==e&&e!==o(569)+o(536)){e=i.guild[o(546)+"ls"].cache.get(e);if(e){if(s[o(444)](o(538),s.BENfo)){n=e;break}s.clear()}}}else n.error(o(490)+"updating invite usage:",u);else u&&s[o(444)](u,"")&&s.eEgxH(u,s[o(457)])&&(n=i.guild[o(546)+"ls"][o(519)].get(u));if(n&&!sentLeaveEmbeds.has(i.id)){var c=i[o(454)].displayAvatarURL({format:"png",dynamic:!0,size:4096}),l=await getUserBannerURL(i);let e="Unknown",r=0;try{var g=await Invite[o(522)+"e"]({guildID:i[o(571)].id,"joinedUsers.userID":i.id});if(g&&g.inviterID){if(s[o(461)](s.IoAaw,s[o(510)]))return"";var d=await i[o(571)].members.fetch(g[o(518)+o(581)])[o(558)](()=>null);d&&(e=d.user[o(418)+"me"],r=g[o(476)]||0)}}catch(e){}let t="",a=("MESSAGE"!==config["LeaveM"+o(441)].Type&&config.LeaveMessage.Type!==o(473)||(t=replacePlaceholders(config[o(515)+"essage"][o(516)]||"",i,"",null,"",e,r,c,l,!1)),null);config.LeaveMessage[o(449)]!==s[o(421)]&&config["LeaveM"+o(441)][o(449)]!==s.mqesX||(a=(new EmbedBuilder).setColor(config.LeaveMessage[o(417)].Color||o(565)+"0"),(d=s[o(471)](replacePlaceholders,config["LeaveM"+o(441)].Embed[o(570)]||"",i,"",null,"",e,r,c,l,!1))&&s.odfUd(d.trim(),"")&&a[o(544)+"le"](d),(g=replacePlaceholders(config[o(515)+"essage"][o(417)]["Descri"+o(439)][o(533)]("\n")||"",i,"",null,"",e,r,c,l,!0))&&""!==g.trim()&&a["setDes"+o(477)+"on"](g),d=replacePlaceholders(config[o(515)+o(441)][o(417)].Footer.Text||"",i,"",null,"",e,r,c,l,!1,!0),g=s[o(455)](replacePlaceholders,config["LeaveM"+o(441)].Embed.Footer.Icon||"",i,"",null,"",e,r,c,l,!1,!0),d&&""!==d[o(448)]()&&a.setFooter({text:d,iconURL:g||void 0}),d=s[o(455)](replacePlaceholders,config[o(515)+o(441)].Embed.Author[o(516)]||"",i,"",null,"",e,r,c,l,!1,!0),g=replacePlaceholders(config[o(515)+o(441)][o(417)].Author[o(529)]||"",i,"",null,"",e,r,c,l,!1,!0),d&&""!==d.trim()&&(s[o(491)](s.BoLHT,o(577))?n.error(s[o(426)],u):a["setAut"+o(531)]({name:d,iconURL:g||void 0})),config["LeaveM"+o(441)].Embed["Thumbn"+o(567)]&&""!==config[o(515)+"essage"][o(417)][o(445)+"ail"][o(448)]()&&(d=s[o(461)](config[o(515)+"essage"][o(417)].Thumbnail,"{user-"+o(427)+"}")?c:config.LeaveMessage[o(417)].Thumbnail,a[o(513)+o(523)](d)),config[o(515)+o(441)][o(417)][o(584)]&&""!==config[o(515)+"essage"].Embed.Image[o(448)]()&&(g=config[o(515)+o(441)].Embed[o(584)]===s.yJsnU?l:config.LeaveMessage.Embed[o(584)])&&""!==g&&a[o(470)+"ge"](g));try{let r;"BOTH"===config.LeaveMessage[o(449)]?r=await n[o(526)]({content:t,embeds:[a]}):s[o(461)](config["LeaveM"+o(441)].Type,"MESSAGE")?r=await n[o(526)](t):s[o(556)](config.LeaveMessage.Type,o(488))&&(r=await n.send({embeds:[a]}));var v=Boolean(config?.[o(515)+o(441)]?.AutoDelete?.[o(547)+"d"]),f=config?.[o(515)+"essage"]?.[o(492)+"lete"]?.[o(495)]||"",m=v?parseTime(f):0;r&&v&&0<m&&setTimeout(()=>{var e=o;r[e(521)]()[e(558)](()=>{})},m)}catch(e){console.error("[ERROR"+o(456)+"ed to send l"+o(507)+"essage:",e)}sentLeaveEmbeds.add(i.id)}}}async function getUserBannerURL(e){var r=aA;try{return(await e.user[r(585)]()).bannerURL({format:"png",dynamic:!0,size:4096})||null}catch(e){return console[r(438)]("Error "+r(429)+r(540)+"r banner:",e),null}}async function updateMemberCount(e){var r=aA,t=getLogChannel(e[r(571)],config["Member"+r(499)+"hannel"]);t&&(e=replacePlaceholders(config["MemberCountChannel"+r(532)]||"",e,"",null,"","",!1),t.setName(e)[r(558)](console.error))}function b(n,e){let i=a();return(b=function(e,r){e-=417;let t=i[e];void 0===b.gnTYXk&&(b.ZKEAQb=function(n){let i="",t="";for(let e=0,r,t,a=0;t=n.charAt(a++);~t&&(r=e%4?64*r+t:t,e++%4)&&(i+=String.fromCharCode(255&r>>(-2*e&6))))t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(t);for(let e=0,r=i.length;e<r;e++)t+="%"+("00"+i.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(t)},n=arguments,b.gnTYXk=!0);var e=e+i[0],a=n[e];return a?t=a:(t=b.ZKEAQb(t),n[e]=t),t})(n,e)}async function resetUserDataOnLeave(a){var n,i=aA;try{await UserData["findOn"+i(574)+i(578)]({userId:a.id,guildId:a.guild.id},{xp:0,level:0},{new:!0})}catch(e){!{VXkgs:function(e,r){return e!==r}}[i(422)](i(485),i(453))?(a=j(k[i(571)],l["MemberCountC"+i(511)]))&&(n=q(r[i(548)+"CountC"+i(511)+"Name"]||"",s,"",null,"","",!1),a.setName(n)[i(558)](t[i(438)])):console.error("Error resett"+i(464)+i(590)+i(443)+i(579),e)}}async function processKickEvent(t){let a=aA,n={WiFaA:function(e,r){return e*r},MdjVX:function(e,r){return e*r},HMJUv:function(e,r){return e*r},HlbGN:"Unknown",yEJbw:"No reason sp"+a(497)+"d",vWEDr:"XmCvb",BubBu:function(e,r,t,a){return e(r,t,a)},tqAnA:function(e,r){return e!==r},QFFNx:"Ikukn",nTKyT:a(490)+a(586)+a(425)+"ick event:"},i=Date.now();try{var o,s,u=(await t.guild[a(550)+a(563)+"gs"]({limit:20,type:AuditLogEvent.MemberKick})).entries.filter(e=>{var r=a,r=i-e["create"+r(434)+r(436)]<1e4,e=e.target.id===t.id;return r&&e}).sort((e,r)=>r["create"+a(434)+"tamp"]-e["create"+a(434)+a(436)]).first();let e=u?.[a(431)+"or"]||{id:"unknown",username:n.HlbGN,tag:a(580)+"n"},r=u?.[a(493)]||n.yEJbw;kickLogCache.has(t.id)&&(c=kickLogCache.get(t.id),i-c[a(480)+a(560)]<1e4)&&("hwdcv"!==n.vWEDr?(e=c[a(486)+"tor"],r=c.reason):1e4.setThumbnail(i)),u&&(await n.BubBu(handleKickEvent,t.client,t,u),s=(o=await GuildData[a(522)+"eAndUp"+a(578)]({guildID:t.guild.id},{$inc:{cases:1}},{upsert:!0,new:!0,setDefaultsOnInsert:!0}))?o.cases:a(583),await UserData[a(522)+"eAndUp"+a(578)]({userId:t.id,guildId:t[a(571)].id},{$inc:{kicks:1}},{upsert:!0,new:!0}),logKick(t,r,e,s))}catch(e){if(n[a(420)](n[a(442)],"eyWKs"))console[a(438)](n[a(549)],e);else{var c=1e4.match(/^(\d+)([smhd])$/);if(!c)return 0;var r=i(c[1]);switch(c[2]){case"s":return n.WiFaA(r,1e3);case"m":return 1e3*n[a(552)](r,60);case"h":return n.WiFaA(60*r*60,1e3);case"d":return 60*n[a(525)](24*r,60)*1e3;default:return 0}}}}function logKick(e,r,t,a){var n=aA,i={pPfFU:function(e){return e()},PIuzJ:function(e,r,t,a,n,i,o,s,u,c,l){return e(r,t,a,n,i,o,s,u,c,l)},PtJVK:"#FF5555"},o=i.pPfFU(moment).tz(config[n(534)+"ne"]),o=(e.id,e.user[n(418)+"me"],e.user.tag,t.id,n(541),o.format("HH:mm"),o[n(512)](n(450)+n(504)),i.PIuzJ(replacePlaceholders,config[n(568)+"gs"][n(417)]["Descri"+n(439)][n(533)]("\n")||"",e,r,t,a,"",0,"","",!0)),i=(new EmbedBuilder)[n(520)+"or"](config.KickLogs.Embed.Color||i[n(423)]).setTitle(replacePlaceholders(config[n(568)+"gs"].Embed[n(570)]||"",e,r,t,a,"",0,"","",!0)).setDescription(o),o=replacePlaceholders(config.KickLogs[n(417)].Footer[n(516)]||"",e,r,t,a,"",0,"","",!0),r=(o&&""!==o[n(448)]()&&i.setFooter({text:o,iconURL:config[n(568)+"gs"][n(417)][n(463)].Icon||void 0}),e[n(454)]["displa"+n(502)+"rURL"]({dynamic:!0})),t=(r&&i[n(513)+"mbnail"](r),getLogChannel(e.guild,config[n(568)+"gs"]["LogsCh"+n(459)+"D"]));t&&t[n(526)]({embeds:[i]})}function replacePlaceholders(e,r,t="",a={},n="",i="",o=0,s="",u="",c,l=!1){var g=aA,d={QppgY:function(e,r){return e/r},EDIef:function(e,r){return e/r},twpHX:function(e,r){return e(r)},StzMn:function(e,r){return e(r)},aHREb:g(450)+g(432),BDXmX:g(450)+g(432)+g(500)+"A"};if(!e)return"";var v=r.guild.iconURL({format:g(419),dynamic:!0})||"",f=moment().tz(config.Timezone),m=r[g(460)+"At"]?Math[g(575)](r[g(460)+"At"].getTime()/1e3):Math[g(575)](d.QppgY(Date[g(458)](),1e3)),w=Math.floor(d[g(514)](r[g(454)][g(428)+g(433)].getTime(),1e3)),L=Math[g(575)](d[g(517)](Date[g(458)](),1e3)),A=r.joinedAt?d[g(535)](moment,r.joinedAt).tz(config[g(534)+"ne"]):f,p=d.StzMn(moment,r.user["create"+g(433)]).tz(config[g(534)+"ne"]);let M=e.replace(/{user}/g,"<@"+r.id+">")[g(555)+"e"](/{userName}/g,r.user.username).replace(/{userTag}/g,r.user[g(541)])[g(555)+"e"](/{userId}/g,r.user.id)[g(555)+"e"](/{reason}/g,t).replace(/{moderator}/g,a?"<@"+a.id+">":"Unknown").replace(/{caseNumber}/g,n)[g(555)+"e"](/{memberCount}/g,r[g(571)][g(530)+"Count"]).replace(/{memberCountNumeric}/g,r.guild["member"+g(573)])[g(555)+"e"](/{guildName}/g,r[g(571)].name)[g(555)+"e"](/{user-avatar}/g,s).replace(/{userBanner}/g,u).replace(/{guildIcon}/g,v)[g(555)+"e"](/{invitedBy}/g,i)[g(555)+"e"](/{invitedByCount}/g,o);return M=l?M.replace(/{user-createdAt}/g,p[g(512)]("MM/DD/YYYY")).replace(/{user-joinedAt}/g,A.format("MM/DD/"+g(472)))[g(555)+"e"](/{shortTime}/g,f[g(512)]("h:mm A"))[g(555)+"e"](/{longTime}/g,f.format(d[g(543)]))[g(555)+"e"](/{joinDate}/g,A[g(512)](g(553)+g(472)))[g(555)+"e"](/{joinTime}/g,A.format("h:mm A"))[g(555)+"e"](/{joinDateTime}/g,A[g(512)](g(450)+g(432)+g(500)+"A"))[g(555)+"e"](/{joinRelative}/g,A.fromNow()).replace(/{leaveDate}/g,f.format("MM/DD/YYYY"))[g(555)+"e"](/{leaveTime}/g,f[g(512)]("h:mm A")).replace(/{leaveDateTime}/g,f.format("MMMM D, YYYY"+g(500)+"A"))[g(555)+"e"](/{leaveRelative}/g,"just now")[g(555)+"e"](/{UserCreation}/g,p.fromNow())[g(555)+"e"](/{createdDate}/g,p[g(512)]("MM/DD/YYYY")).replace(/{createdDateTime}/g,p.format(d[g(542)]))[g(555)+"e"](/{createdRelative}/g,p.fromNow()):M[g(555)+"e"](/{user-createdAt}/g,"<t:"+w+g(527)).replace(/{user-joinedAt}/g,"<t:"+m+g(527))[g(555)+"e"](/{shortTime}/g,g(482)+L+":t>")[g(555)+"e"](/{longTime}/g,"<t:"+L+g(435)).replace(/{joinDate}/g,g(482)+m+g(527))[g(555)+"e"](/{joinTime}/g,"<t:"+m+g(588)).replace(/{joinDateTime}/g,g(482)+m+":f>").replace(/{joinRelative}/g,"<t:"+m+":R>").replace(/{leaveDate}/g,g(482)+L+g(527))[g(555)+"e"](/{leaveTime}/g,g(482)+L+g(588))[g(555)+"e"](/{leaveDateTime}/g,g(482)+L+":f>").replace(/{leaveRelative}/g,g(482)+L+":R>").replace(/{UserCreation}/g,g(482)+w+g(452))[g(555)+"e"](/{createdDate}/g,"<t:"+w+":d>").replace(/{createdDateTime}/g,g(482)+w+g(479))[g(555)+"e"](/{createdRelative}/g,g(482)+w+g(452))}setInterval(()=>{sentLeaveEmbeds.clear()},LEAVE_EMBED_RESET_INTERVAL),module.exports=async(e,r)=>{var t,a=aA,n={jiNJP:function(e,r){return e(r)},YGwhL:function(e,r){return e(r)},QgGeV:function(e,r,t){return e(r,t)}};r&&r.id!==e[a(454)].id&&(await saveUserRoles(r),await n[a(451)](sendLeaveMessage,r),await updateMemberCount(r),await n.YGwhL(processKickEvent,r),t=require(a(551)+"ls/tic"+a(481)+a(462)+a(537)+a(475)).handleUserTickets,await n.QgGeV(t,e,r),config[a(582)+a(466)+"em"][a(547)+"d"]&&config[a(582)+a(466)+"em"]["ResetD"+a(465)+"eave"]&&await resetUserDataOnLeave(r),await updateInviteUsage(r))};