let Z=b,{EmbedBuilder,ChannelType}=((()=>{for(var e=b,n=a();;)try{if(731968==-parseInt(e(409))*(-parseInt(e(370))/2)+-parseInt(e(347))/3+parseInt(e(461))/4+-parseInt(e(496))/5+-parseInt(e(523))/6*(-parseInt(e(519))/7)+-parseInt(e(359))/8+parseInt(e(486))/9*(parseInt(e(501))/10))break;n.push(n.shift())}catch(e){n.push(n.shift())}})(),require(Z(493)+"d.js")),UserData=require("../../"+Z(447)+"/UserD"+Z(450)),{getConfig,getLang,getCommands}=require(Z(477)+"utils/core/configL"+Z(441)+"js"),{getLogChannel}=require(Z(477)+"utils/handlers/mes"+Z(500)+"ils.js"),config=getConfig(),lang=getLang(),xpCooldown=new Map,voiceXpTimers=new Map,xpBatchQueue=new Map,XP_BATCH_SIZE=250,XP_BATCH_TIMEOUT=4e3,xpBatchTimeout=null;function getRandomXP(e){var n=Z,[e,t]=e[n(448)]("-").map(Number);return Math[n(353)](Math[n(485)]()*{ZbBTV:function(e,n){return e+n}}[n(424)](t-e,1))+e}function calculateXPNeeded(c){let a1=Z,d={gzszN:function(e,n){return e*n},EoTBy:function(e,n){return e+n},rdCFp:function(e,n){return e*n}};if(0===c)return 70;if(config[a1(490)+a1(398)+"em"][a1(511)+a1(386)]&&config[a1(490)+"ngSystem"].Formula)try{let e=config.LevelingSystem[a1(529)+"a"].replace(/\{level\}/g,(c+1).toString()),f=eval(e.replace(/\^/g,"**"));return Math[a1(399)](1,Math[a1(353)](f))}catch(g){return console[a1(387)](a1(373)+"evalua"+a1(400)+"P formula:",g),d[a1(395)](d.EoTBy(c,1),config[a1(490)+a1(398)+"em"].XPNeeded)}return d[a1(508)](c+1,config.LevelingSystem[a1(365)+"ed"])}function getRandomLevelMessage(e){var n=Z,t=lang.Levels[n(503)+n(403)+"s"];return replacePlaceholders(t[Math.floor({fICdD:function(e,n){return e*n}}[n(437)](Math.random(),t.length))],e)}function replacePlaceholders(e,t){return e[Z(372)+"e"](/{(\w+)}/g,(e,n)=>t[n]||"{"+n+"}")}function isValidUrl(e){var t=Z,r={AUHli:function(e,n,t){return e(n,t)},leZVh:function(e,n){return e!==n}};try{return new URL(e),!0}catch(e){if(r[t(528)]("zFtoV","tMqLp"))return!1;h||(m=r[t(356)](n,o,p))}}function parseTime(e){var n=Z,t={qkUnO:function(e,n){return e(n)},bzwup:function(e,n){return e*n},sYOYU:function(e,n){return e*n}},e=e[n(411)](/^(\d+)([smhd])$/);if(!e)return 0;var r=t[n(530)](parseInt,e[1]);switch(e[2]){case"s":return t.bzwup(r,1e3);case"m":return t[n(351)](60*r,1e3);case"h":return 1e3*t.bzwup(60*r,60);case"d":return 24*r*60*60*1e3;default:return 0}}async function processXPBatch(){var e,o=Z,l={UDFDd:function(e,n){return e/n},KqviO:o(378),VStUl:function(e,n){return e===n},otCQz:"FWyLS",qHxpm:o(413),DPruh:"../../utils/core/p"+o(357)+o(423)};if(0!==xpBatchQueue.size)try{let a=[];for(let[n,r]of xpBatchQueue.entries())if(l[o(491)]===o(393))n[o(410)]("[LEVEL"+o(518)+"ould n"+o(375)+o(401)+o(532)+r+o(421)+"ild "+h+o(520)+"ument "+o(463)+"ve been dele"+o(467));else{let[t,e]=n.split(":");if(r["checkL"+o(417)])await handleAtomicXPUpdate(t,e,r.xpToAdd,r[o(453)+"e"]);else if(l.VStUl(l[o(533)],o(509))){let n=r.from(h[o(451)+"s"]()),e=n[o(354)](0,t.floor(l[o(516)](n[o(436)],4)));e[o(515)+"h"](([e])=>n(e)),e.length}else a[o(474)]({updateOne:{filter:{userId:t,guildId:e},update:{$inc:{xp:r.xpToAdd},$setOnInsert:{userId:t,guildId:e,level:0,totalMessages:0,balance:0,warns:0,bans:0,kicks:0,timeouts:0,note:"None",warnings:[]}},upsert:!0}})}0<a[o(436)]&&("wrmuR"!==l.qHxpm?(e=require(l.DPruh).observeAsync,await e("xp.bul"+o(344),async()=>UserData.bulkWrite(a,{ordered:!1}))):(g[o(387)]("Error processing XP batch:",h),i.clear(),j=null)),xpBatchQueue.clear(),xpBatchTimeout=null}catch(e){console[o(387)]("Error processing X"+o(527)+"h:",e),xpBatchQueue[o(483)](),xpBatchTimeout=null}}function b(i,e){let o=a();return(b=function(e,n){e-=343;let t=o[e];void 0===b.zaaxTH&&(b.qkGgwi=function(a){let i="",t="";for(let e=0,n,t,r=0;t=a.charAt(r++);~t&&(n=e%4?64*n+t:t,e++%4)&&(i+=String.fromCharCode(255&n>>(-2*e&6))))t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(t);for(let e=0,n=i.length;e<n;e++)t+="%"+("00"+i.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(t)},i=arguments,b.zaaxTH=!0);var e=e+o[0],r=i[e];return r?t=r:(t=b.qkGgwi(t),i[e]=t),t})(i,e)}function scheduleXPBatchProcess(){xpBatchTimeout=xpBatchTimeout||setTimeout(processXPBatch,XP_BATCH_TIMEOUT)}async function handleAtomicXPUpdate(o,l,c,d){var f=Z,g={PJDJL:f(390),tnjXs:f(431)+"up",dDnhK:"Error in atomic XP"+f(429)+"e:"};try{var e=await UserData[f(435)+"eAndUp"+f(504)]({userId:o,guildId:l},{$inc:{xp:c},$setOnInsert:{userId:o,guildId:l,level:0,totalMessages:0,balance:0,warns:0,bans:0,kicks:0,timeouts:0,note:f(381),warnings:[]}},{upsert:!0,new:!0});if(e){let n=e.level,a=e.xp;var v=e[f(469)];let i=0;for(;;)if(g.PJDJL===f(366))n.has(a)&&(q(r.get(s)),t.delete(u));else{var h=calculateXPNeeded(n);if(!(a>=h))break;a-=h,n+=1,i++}if(0<i){let e=await UserData[f(435)+"eAndUp"+f(504)]({userId:o,guildId:l},{$set:{xp:a,level:n}},{new:!0});e&&d&&(await handleLevelUpRewards(e,d),await sendLevelUpMessage(e,v,d),global[f(452)+f(514)])&&global["addonL"+f(514)][f(517)+f(442)+"ger"]().emitSafe(g.tnjXs,{user:d[f(505)],member:d.member,guild:d[f(360)],userData:e[f(352)+"ct"](),oldLevel:v,newLevel:n,levelsGained:i,xpGained:c,totalXP:e.xp})}}}catch(e){console.error(g[f(433)],e)}}async function checkLevelUp(e,a,i){var o=Z,u={WUajh:function(e,n,t){return e(n,t)},bUHmS:function(e,n){return e(n)},VeZQi:function(e,n){return n<=e},dIXOw:function(e,n){return e===n},AuJTV:"wnlMC",crZjx:function(e,n,t,r){return e(n,t,r)},oyBjk:o(431)+"up",OXhGy:function(e,n){return e!==n}};try{var c=await UserData[o(435)+"e"]({userId:e,guildId:a});if(c){let n=c[o(469)],t=c.xp;var s=c.level;let r=0;for(;;){let e=calculateXPNeeded(n);if(!u[o(471)](t,e))break;t-=e,n+=1,r++}if(0<r)if(u[o(458)](u[o(418)],"wnlMC")){var d,f,g=await UserData["findOneAndUp"+o(504)]({userId:e,guildId:a},{$set:{xp:t,level:n}},{new:!0,upsert:!1});if(g)await handleLevelUpRewards(g,i),await u[o(481)](sendLevelUpMessage,g,s,i),global[o(452)+o(514)]&&global.addonLoader[o(517)+o(442)+"ger"]()[o(472)+"fe"](u.oyBjk,{user:i[o(505)],member:i[o(367)],guild:i[o(360)],userData:g[o(352)+"ct"](),oldLevel:s,newLevel:n,levelsGained:r,totalXP:g.xp});else{if(!u.OXhGy("zDgXC",o(531)))return f=(d=n.Levels[o(503)+o(403)+"s"])[t[o(353)](s.random()*d.length)],u[o(427)](r,f,l);console.warn(o(456)+"ING] Could n"+o(375)+o(401)+"er "+e+(o(421)+o(379))+a+(o(520)+o(438))+"may ha"+o(422)+o(465)+o(467))}}else u.bUHmS(u,c),n=null}}catch(e){console.error("Error "+o(380)+o(446)+"check:",e)}}function findRoleForGuild(e,n){const t=Z,r=t(475)+"D";var a;if(e)for(a of Array[t(363)+"y"](e)?e:[e])if(a&&""!==a&&a!==r){var i=n.roles[t(383)].get(a);if(i)return i}return null}async function handleLevelUpRewards(e,n){const t=Z,r=function(e,n){return e%n},a=function(e,n){return n<e},i=config["Leveli"+t(398)+"em"].RoleSettings["LevelR"+t(419)]||[];for(var o of i)if(e[t(469)]>=o.level&&o.roleID){var l=findRoleForGuild(o[t(389)],n[t(360)]);if(l)try{if("ixfsm"!==t(397))return;if(await n.member[t(512)].add(l),!config.LevelingSystem["RoleSe"+t(535)].StackRoles)for(var u of i)if(e[t(469)]>u[t(469)]&&u[t(389)]){var c=findRoleForGuild(u[t(389)],n.guild);if(c&&c.id!==l.id)try{await n.member.roles.remove(c)}catch(e){console[t(387)](t(456)+t(489)+t(470)+"emovin"+t(457)+": "+e[t(453)+"e"])}}}catch(e){console[t(387)](t(456)+"ING] E"+t(521)+t(464)+"ng role: "+e.message)}}var s;let d={level:0,coins:0};for(s of(config["Leveli"+t(398)+"em"][t(396)+"ttings"]["ScaleR"+t(412)]||{}).Rewards||[])0===r(e[t(469)],s.level)&&a(s.coins,d[t(414)])&&(d=s);0<d.coins&&(e.balance+=d[t(414)])}async function sendLevelUpMessage(t,r,a){var i=Z,o={qccwA:function(e,n){return e===n},oOtwU:function(e,n){return e(n)},ricLM:function(e,n){return e-n},pWKjJ:"FNjys",uxsak:function(e,n,t){return e(n,t)},oaRMw:function(e,n){return e!==n}};if(config.LevelingSystem["LevelU"+i(402)+i(405)+"ings"][i(376)+"d"]){let e=a.channel;var l=getLogChannel(a.guild,config["Leveli"+i(398)+"em"][i(468)+"lSettings"][i(407)+"pChannelID"]);l&&o.qccwA(l.type,ChannelType[i(536)+i(369)])&&(e=l);let n={userId:a[i(505)].id,tag:a.author.tag,username:a.author[i(348)+"me"],userName:a.author[i(348)+"me"],user:"<@"+a.author.id+">",userMention:"<@"+a.author.id+">",userIcon:a[i(505)][i(525)+i(454)+"rURL"]({dynamic:!0}),userBanner:a[i(505)][i(460)+"URL"]({dynamic:!0,size:512})||a[i(505)]["displa"+i(454)+i(459)]({dynamic:!0}),oldLevel:r,newLevel:t[i(469)],oldXP:o[i(466)](calculateXPNeeded,o[i(478)](r,1)),newXP:calculateXPNeeded(t.level),xp:t.xp,xpNeeded:o.oOtwU(calculateXPNeeded,t.level),serverName:a[i(360)][i(476)],guildName:a[i(360)][i(476)],guildIcon:a[i(360)].iconURL({dynamic:!0})||"",randomLevelMessage:getRandomLevelMessage({user:"<@"+a.author.id+">",userName:a.author[i(348)+"me"],newLevel:t.level,guildName:a.guild[i(476)]})};try{if(config.LevelingSystem[i(407)+"pMessa"+i(405)+i(416)][i(349)+"ed"]){var u,c=(new EmbedBuilder)[i(346)+"or"](config["Leveli"+i(398)+"em"][i(407)+"pMessageSett"+i(416)].Embed.Color||"#34eb6b");if(config["Leveli"+i(398)+"em"]["LevelUpMessageSett"+i(416)][i(385)][i(462)]){if("FNjys"!==o.pWKjJ)return e[i(387)]("Error "+i(408)+i(400)+"P formula:",l),(n+1)*c[i(490)+i(398)+"em"].XPNeeded;c.setTitle(o.uxsak(replacePlaceholders,config["Leveli"+i(398)+"em"][i(407)+i(402)+"geSettings"][i(385)][i(462)],n))}config.LevelingSystem[i(407)+"pMessageSett"+i(416)].Embed.Description&&0<config[i(490)+i(398)+"em"][i(407)+"pMessageSettings"][i(385)].Description[i(436)]&&c[i(534)+"cription"](config.LevelingSystem["LevelUpMessa"+i(405)+"ings"][i(385)]["Descri"+i(391)].map(e=>replacePlaceholders(e,n))[i(426)]("\n")),config[i(490)+i(398)+"em"][i(407)+i(402)+"geSett"+i(416)][i(385)].Footer&&config["Leveli"+i(398)+"em"]["LevelU"+i(402)+"geSettings"].Embed.Footer.Text&&(u=replacePlaceholders(config[i(490)+i(398)+"em"][i(407)+i(402)+i(405)+i(416)][i(385)][i(377)][i(444)],n),c[i(498)+i(484)]({text:u})),await e[i(415)]({embeds:[c]})}else{var s=replacePlaceholders(config[i(490)+"ngSystem"][i(407)+i(402)+i(405)+i(416)].LevelUpMessage,n);o[i(343)](s.trim(),"")&&await e.send(s)}}catch(e){console[i(387)](i(373)+i(473)+i(495)+"l up message:",e)}}}function a(){let e=["DMuGyMvL","AxrVCG","wMjcvfy","u0Lhvevs","AM9PBG","v1vHAMG","wfbdB29S","ihvWzgf0","Aw5JBhvK","Bgv2zwW6","Egjgthu","zerUAeS","mJbZ","zMLUze9U","BgvUz3rO","zKLdzeq","Dw1LBNqG","CgfYzw50","vxP6Ce4","B2fKzxiU","BNrnyw5H","uNHcuee","vgv4Da","z2v0","zwWGDxaG","Bw9KzwXZ","C3bSAxq","D25tzxr0","yxrH","zw50CMLL","ywrKB25m","BwvZC2fN","Euf2yxrH","BfnLDhrP","w0XfvKvm","zYbYB2XL","zeLyt3C","CLvsta","yMfUBMvY","mtaYmJq3mNzLCu1dCG","vgL0Bgu","Bwf5igHH","C3nPz25P","BIbKzwXL","B090D1u","DgvK","q2HHBM5L","Bgv2zwW","CNjVCIbY","vMvAuwK","zw1PDfnH","C2vUzgLU","ChvZAa","uK9mrv9j","BMfTzq","lI4VlI4V","CMLJte0","q29TBwfU","twvZC2fN","y3jAANG","rgLZywjS","y2XLyxi","DgvY","CMfUzg9T","mtK4nJnNsfrzAve","thvhCwO","EhbuB0fK","su5hxsbf","tgv2zwXP","s3f2Au8","y2HHBM5L","zgLZy29Y","BMvSCW","zYbSzxzL","nZaZmJeYmgXAwKXpBa","vLfjzuq","C2v0rM9V","BMCGwfa6","C2fNzvv0","nZe3meztvgXsyW","zg93BG","tgv2zwXn","zgf0zq","yxv0Ag9Y","zNjVBq","qMHYDNu","CMrdrNa","s1rxvgq","DxnLCG","vxnLrM9Y","CM9Szxm","C3rHCNrZ","B2fKzxi","zM9YrwfJ","vurgrgq","z2v0rxzL","su5hxsbd","ntK5owzVu1LVBq","ic0Gzg9J","CNjVCIbH","rKPhseW","otmZmejVBNDesW","AKvrA1y","zgLZCgXH","zhnqCMvM","ucbIyxrJ","BgvAvMG","rM9YBxvS","CwTvBK8","vhfZtu0","zxiG","B3rduxO","C2v0rgvZ","DhrPBMDZ","r3vPBgru","C2L6zq","B2fstxC","A1DYAxrL","AgfUzgXP","C2v0q29S","mZy3ndy2ngHOCgXcyq","DxnLCM5H","vxnLrw1I","BMDZ","C1Lpwvu","Dg9pyMPL","zMXVB3i","C2XPy2u","vMrcqNq","qvviBgK","zxjMtw9U","q29VBgrV","mZmWnda0ohbUEwfSqW","z3vPBgq","wLz5yMW","C0HKz2K","AxnbCNjH","y29UDgvU","wfbozwvK","wu1fwLG","BwvTyMvY","C2v0","zxH0","mtu4ExDWrMLo","DM9Py2u","CMvWBgfJ","rxjYB3iG","BhbkDM0","B3qGDxbK","rw5HyMXL","rM9VDgvY","rfvVAKK","AwXKia","Aw4GBgv2","tM9Uzq","rw1qCMy","y2fJAgu","zgvSzxrL","rw1Izwq","BxvSyq","zxjYB3i","Aezisuu","CM9SzuLe","tunPCgG","ChrPB24","y2HLy2Tm","BgXHBwS","zKrXu3e","z3PZEK4","uM9SzvnL","AxHMC20","BMDtExn0","Bwf4","DgLUzYby","yxrLihvZ","Ce1LC3nH","zxnZywDL","yxHlt2q","z2vtzxr0","z29YAwvZ","tgv2zwXv","zxzHBhvH","nZy2nMHpyuXgAW","D2fYBG","Bwf0y2G","zxDHCMrZ","ruTyte4","y29PBNm","C2vUza","Aw5NCW","zxzLBfvW","qxvkvfy","B2XLCW","u0Lhsu5u","igLUigD1"];return(a=function(){return e})()}async function handleXP(r){let a=Z,i={sHdgi:"FJGHL",lpJvm:function(e,n){return e(n)},xbFLu:function(e,n){return e<n},jEQkV:function(e,n){return e+n},aHnCr:function(e,n){return e(n)},fDqSq:function(e,n){return e<=n},GEThn:function(e){return e()},RxBPA:a(497)};if(r&&r[a(360)]){if(!config.LevelingSystem||!config[a(479)+a(526)+"ix"]){if(i[a(362)]===a(522))return;e=f}if(!(!config[a(490)+"ngSystem"][a(376)+"d"]||r[a(505)].bot||r[a(364)+"t"][a(513)+"With"](config[a(479)+a(526)+"ix"])||config[a(490)+"ngSystem"][a(468)+a(455)+"ngs"][a(482)+"edChannels"]?.includes(r.channel.id)||r.channel.parentId&&config[a(490)+a(398)+"em"]["Channe"+a(455)+a(350)].DisabledCategories?.[a(430)+"es"](r.channel.parentId))){if(config[a(490)+"ngSystem"][a(358)+a(449)+"ings"]["EnableXPCool"+a(502)]){let e=i.lpJvm(parseTime,config.LevelingSystem["CooldownSett"+a(416)].XPCooldown||a(434)),n=Date.now(),t=xpCooldown[a(445)](r[a(505)].id);if(t&&i[a(432)](n,i[a(524)](t,e)))return;xpCooldown.set(r.author.id,n),setTimeout(()=>xpCooldown[a(384)](r.author.id),e+1e3)}try{var n=getRandomXP(config["Leveli"+a(398)+"em"][a(480)+"eXP"]);if(!i.aHnCr(isNaN,n)&&!i[a(394)](n,0)){var t=r[a(505)].id+":"+r[a(360)].id,o=xpBatchQueue.get(t)||{xpToAdd:0,checkLevelUp:!1,message:null};if(o[a(488)+"d"]+=n,o[a(392)+"evelUp"]=!0,o.message=r,xpBatchQueue[a(368)](t,o),xpBatchQueue.size>=XP_BATCH_SIZE){if(xpBatchTimeout){if(a(382)!==a(382))return;i[a(374)](clearTimeout,xpBatchTimeout),xpBatchTimeout=null}await i.GEThn(processXPBatch)}else a(487)!==a(487)?e(f):scheduleXPBatchProcess()}}catch(e){if(i[a(443)]!==a(388))console.error("Error "+a(345)+a(499),e);else try{return new g(h),!0}catch(e){return!1}}}}}function cleanupVoiceTimer(e){var n=Z;voiceXpTimers.has(e)&&(clearInterval(voiceXpTimers[n(445)](e)),voiceXpTimers[n(384)](e))}async function handleVoiceXP(e,n){var t,r,a=Z,i={DNNQi:function(e,n){return e(n)},ZVybl:function(e,n){return n<=e}};n&&n.guild&&config[a(490)+"ngSystem"][a(376)+"d"]&&!n[a(510)].bot&&(!n[a(371)]?.[a(492)+"l"]||n[a(371)][a(492)+"l"].parentId&&config["Leveli"+a(398)+"em"][a(468)+"lSettings"][a(482)+"edCate"+a(406)]?.[a(430)+"es"](n.voice.channel[a(439)+"Id"])||config.LevelingSystem["Channe"+a(455)+a(350)][a(482)+"edChan"+a(494)]?.[a(430)+"es"](n.voice.channel.id)||(t=i.DNNQi(getRandomXP,config[a(490)+"ngSystem"].VoiceXP),isNaN(t))||t<=0||(n=n.id+":"+n.guild.id,(r=xpBatchQueue.get(n)||{xpToAdd:0,checkLevelUp:!1,message:null}).xpToAdd+=t,xpBatchQueue[a(368)](n,r),i[a(361)](xpBatchQueue[a(537)],XP_BATCH_SIZE)?(xpBatchTimeout&&(clearTimeout(xpBatchTimeout),xpBatchTimeout=null),await processXPBatch()):scheduleXPBatchProcess()))}setInterval(()=>{let n=Z,e={qidzP:function(e,n){return n<e},Bhrvu:function(e,n){return e-n}},t=Date.now();for(var[r,a]of xpCooldown[n(451)+"s"]())e.qidzP(t-a,6e4)&&xpCooldown.delete(r);300<xpCooldown[n(537)]&&Array[n(506)](xpCooldown.entries()).sort((e,n)=>e[1]-n[1])[n(354)](0,e[n(507)](xpCooldown.size,300))[n(515)+"h"](([e])=>xpCooldown[n(384)](e))},3e4),setInterval(()=>{var e,n=Z;30<voiceXpTimers.size&&((e=(e=Array[n(506)](voiceXpTimers[n(451)+"s"]()))[n(354)](0,Math[n(353)](e[n(436)]/4))).forEach(([e])=>cleanupVoiceTimer(e)),e.length)},12e4),process.on(Z(425)+"M",async()=>{let l=Z,u={jviEM:function(e,n){return e+n},VdBBt:function(e,n){return e(n)}};if(xpBatchTimeout)if(l(404)!==l(440))clearTimeout(xpBatchTimeout);else{let e=m(n[l(490)+l(398)+"em"]["CooldownSett"+l(416)][l(428)+l(502)]||"20s"),a=o.now(),i=p.get(q.author.id);if(i&&a<i+e)return;r.set(s.author.id,a),t(()=>e.delete(a[l(505)].id),u.jviEM(e,1e3))}await processXPBatch(),voiceXpTimers[l(515)+"h"]((e,n)=>{var t=l;u[t(355)](clearInterval,e)}),voiceXpTimers.clear()}),process.on(Z(420),async()=>{var e=Z;xpBatchTimeout&&clearTimeout(xpBatchTimeout),await processXPBatch(),voiceXpTimers[e(515)+"h"]((e,n)=>{clearInterval(e)}),voiceXpTimers[e(483)]()}),module.exports={handleXP:handleXP,handleVoiceXP:handleVoiceXP};